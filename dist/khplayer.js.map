{"version":3,"names":[],"mappings":"","sources":["khplayer.js"],"sourcesContent":["/* eslint-disable max-len */\r\n// ! ================================================\r\n// ! KHPLayer\r\n// ! Version: 6.4\r\n// ! Homepage: https://khplayer.delnegend.com\r\n// ! License: The MIT License (MIT)\r\n// ! ================================================\r\n// jshint esversion: 9\r\n// jshint expr:true\r\n\r\nconst KHPlayer = {\r\n  d(e) {\r\n    return document.querySelector(e);\r\n  },\r\n  id(e) {\r\n    return document.getElementById(e);\r\n  },\r\n  // Source: https://stackoverflow.com/a/1349426\r\n  randomString(length = 20) {\r\n    let result = '';\r\n    const characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\r\n    const charactersLength = characters.length;\r\n    for (let i = 0; i < length; i++) result += characters.charAt(Math.floor(Math.random() * charactersLength));\r\n    return '_' + result + btoa(new Date().getTime()).replace(/=/g, '');\r\n  },\r\n  one() {\r\n    this.insertAfter(this.currNode, `<khplayer-container data=\"${this.currNode.getAttribute('data')}\"></khplayer-container>`, true);\r\n    this.loadCSS('https://cdn.jsdelivr.net/gh/sampotts/plyr/dist/plyr.css');\r\n    this.loadCSS('https://cdn.jsdelivr.net/gh/DELNEGEND/khplayer/dist/khplayer.min.css');\r\n    if (typeof Plyr === 'undefined') this.loadJS('https://cdn.jsdelivr.net/gh/sampotts/plyr/dist/plyr.min.js');\r\n    if (typeof Hls === 'undefined') this.loadJS('https://cdn.jsdelivr.net/npm/hls.js/dist/hls.min.js');\r\n    if (typeof NoSleep === 'undefined') this.loadJS('https://cdn.jsdelivr.net/gh/richtr/NoSleep.js/dist/NoSleep.min.js');\r\n    const initPlayer = setInterval(() => {\r\n      const check = typeof Plyr && typeof Hls && typeof NoSleep;\r\n      if (check !== 'undefined') {\r\n        clearInterval(initPlayer);\r\n        const uniqueKey = KHPlayer.randomString();\r\n        this.currNode.nextElementSibling.setAttribute('id', uniqueKey);\r\n        this.init(uniqueKey);\r\n      }\r\n    }, 100);\r\n  },\r\n  // Init Plyr\r\n  initPlyr(uniqueKey, previewThumbnails = false) {\r\n    // If prevThumbnails's url exist in need-to-init episode, add it into customConfig - cloned from the original config to avoid adding into the original one\r\n    const customConfig = Object.assign({}, this.configurator);\r\n    if (previewThumbnails) {\r\n      customConfig.previewThumbnails = {\r\n        enabled: true,\r\n        src: previewThumbnails.src,\r\n      };\r\n    }\r\n    return new Promise(function(resolve) {\r\n      resolve(Plyr.setup('#' + uniqueKey + ' video', customConfig));\r\n    });\r\n  },\r\n  // Hàm khởi tạo KHPlayer ở đây\r\n\r\n  // KHPlayer init() here\r\n  // NOTE: in changeEp(), Plyr get destroy() and init() again with new data, anything that related or sit inside Plyr are also destroyed (embed playlist and its toggle btn, next/prev btn, eventListener...), This init() only run once to initiate stuffs outside Plyr's reach, so if you're planning to add any button into Plyr's container or an eventListener, consider using changeEp() or tweaks()\r\n  async init(uniqueKey) {\r\n    const\r\n      khpCtn = this.id(uniqueKey);\r\n    // Gán dữ liệu vào KHPLayer để lát chuyển tập dùng lại\r\n    // Assign data into KHPlayer for re-using in changeEp()\r\n    this.data[uniqueKey] = await this.getJSON(khpCtn.getAttribute('data'));\r\n    // Syntax ngắn hơn\r\n    // Shorter syntax\r\n    PLAYLIST = this.data[uniqueKey];\r\n    // Getting poster and playingIndicator\r\n    // Lấy url Poster, playingIndicator\r\n    const poster = PLAYLIST[PLAYLIST.length - 2] || this.configurator.defaultPoster;\r\n    const historyPlayingIndicator = PLAYLIST[PLAYLIST.length - 1];\r\n    // Create a frame for Plyr to init\r\n    // Tạo 1 cái frame cho Plyr bên trong container player\r\n    khpCtn.innerHTML = /* html */ `\r\n        <video control playsinline></video>\r\n        <ul key=\"${uniqueKey}\" class='KHPPlaylistContainer custom_scrollbar'></ul>`;\r\n    // Set poster\r\n    khpCtn.querySelector('video').setAttribute('poster', poster);\r\n    // Tạo playlist dựa trên dữ liệu JSON\r\n    // Create playlist based on JSON data\r\n    for (let index = 0; index < PLAYLIST.length - 2; index++) {\r\n      const\r\n        elem = document.createElement('li');\r\n      elem.setAttribute('onclick', `KHPlayer.changeEp(this,${index})`);\r\n      elem.innerHTML = PLAYLIST[index].title;\r\n      khpCtn.querySelector(`.KHPPlaylistContainer`).appendChild(elem);\r\n    }\r\n\r\n    // -- Plyr đc khởi tạo ở chỗ này --\r\n    // -- Plyr get init here --\r\n    this.plyr[uniqueKey] = await this.initPlyr(uniqueKey);\r\n    this.id(uniqueKey) && this.tweaks(uniqueKey);\r\n\r\n    // -- Phần này detect lịch sử xem --\r\n    // #region -- Detect watching history --\r\n    const playingData = localStorage.getItem('khplayer_playing_' + historyPlayingIndicator);\r\n    if (playingData) {\r\n      const playingDataJSON = JSON.parse(playingData);\r\n      const confirmi18n = this.configurator.i18n.continueWatchingConfirm;\r\n      // Source: timestamp --> regular: https://stackoverflow.com/a/25279340\r\n      this.insertAfter(\r\n        khpCtn.querySelector(' .plyr>.plyr__control'),\r\n        /* html */ `<div class=\"systemDetectHistory\">\r\n          <div class=\"text\">\r\n          ${confirmi18n.continueWatching} <b>${KHPlayer.data[uniqueKey][playingDataJSON.epIndex].title}</b> ${confirmi18n.at} <b>${new Date(playingDataJSON.time * 1000).toISOString().substr(11, 8)}</b>${confirmi18n.confirm}\r\n          </div>\r\n          <div class=\"actions\">\r\n            <div class=\"confirmBtn\">\r\n              <div onclick='KHPlayer.acceptContinue(\"${uniqueKey}\", ${playingDataJSON.epIndex}, ${playingDataJSON.time})' class=\"buttonInner\">${confirmi18n.yes}</div>\r\n            </div>\r\n            <div class=\"confirmBtn\">\r\n              <div onclick='KHPlayer.rejectContinue(this)' class=\"buttonInner\">${confirmi18n.no}</div>\r\n            </div>\r\n          </div>\r\n        </div>`,\r\n        true,\r\n      );\r\n      khpCtn.querySelector('.plyr>.plyr__controls') && khpCtn.querySelector('.plyr>.plyr__controls').setAttribute('hidden', '');\r\n    }\r\n    // #endregion\r\n\r\n    khpCtn.querySelector('.plyr').addEventListener('click', () => {\r\n      if (playingData) {\r\n        const a = khpCtn.querySelector('.systemDetectHistory');\r\n        if (a && a.classList.contains('hideAlert') && !this.plyr[uniqueKey][0].source) {\r\n          khpCtn.querySelector('ul.KHPPlaylistContainer>li:first-child').click();\r\n        }\r\n      } else {\r\n        if (!this.plyr[uniqueKey][0].source) {\r\n          khpCtn.querySelector('ul.KHPPlaylistContainer>li:first-child').click();\r\n        }\r\n      }\r\n    });\r\n  },\r\n  tweaks(uniqueKey) {\r\n    const khpCtn = this.id(uniqueKey);\r\n\r\n    // Thêm vài nút chức năng vào Plyr\r\n    // #region adding a few button into Plyr's container\r\n\r\n    // Nút ẩn/hiện embed playlist\r\n    // Toggle embed playlist btn\r\n    // <i class=\"fas fa-bars fa-lg\"></i>\r\n\r\n    this.insertAfter(\r\n      khpCtn.querySelector('.plyr__controls>.plyr__menu'),\r\n      `<button class=\"plyr__controls__item plyr__control customBtn\" type=\"button\" onclick=\"KHPlayer.toggleEmbedPlayllist('${uniqueKey}')\">\r\n      <svg aria-hidden=\"true\" focusable=\"false\" data-prefix=\"fas\" data-icon=\"list-ul\" class=\"svg-inline--fa fa-list-ul fa-w-16\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 512 512\"><path fill=\"currentColor\" d=\"M48 48a48 48 0 1 0 48 48 48 48 0 0 0-48-48zm0 160a48 48 0 1 0 48 48 48 48 0 0 0-48-48zm0 160a48 48 0 1 0 48 48 48 48 0 0 0-48-48zm448 16H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-320H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16zm0 160H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16z\"></path></svg>\r\n      <span class=\"plyr__tooltip\">${this.configurator.i18n.toggleEmbedPlayllist}</span>\r\n      </button>`,\r\n      true,\r\n    );\r\n    // Nút next tập\r\n    // Next episode btn\r\n    // <i class=\"fas fa-step-forward fa-lg\"></i>\r\n    this.insertAfter(\r\n      khpCtn.querySelector('.plyr__controls > button:first-child'),\r\n      `<button class=\"plyr__controls__item plyr__control customBtn nextEpBtn\" type=\"button\" onclick=\"KHPlayer.navigateEp(this,'next')\">\r\n      <svg aria-hidden=\"true\" focusable=\"false\" data-prefix=\"fas\" data-icon=\"step-forward\" class=\"svg-inline--fa fa-step-forward fa-w-14\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 448 512\"><path fill=\"currentColor\" d=\"M384 44v424c0 6.6-5.4 12-12 12h-48c-6.6 0-12-5.4-12-12V291.6l-195.5 181C95.9 489.7 64 475.4 64 448V64c0-27.4 31.9-41.7 52.5-24.6L312 219.3V44c0-6.6 5.4-12 12-12h48c6.6 0 12 5.4 12 12z\"></path></svg>\r\n      <span class=\"plyr__tooltip\">${this.configurator.i18n.nextEpisode}</span>\r\n      </button>`,\r\n      true,\r\n    );\r\n    // Nút previous tập\r\n    // Previous episode btn\r\n    // <i class=\"fas fa-step-backward fa-lg\"></i>\r\n    this.insertBefore(\r\n      khpCtn.querySelector('.plyr__controls > button:first-child'),\r\n      `<button class=\"plyr__controls__item plyr__control customBtn prevEpBtn\" type=\"button\" onclick=\"KHPlayer.navigateEp(this,'prev')\">\r\n      <svg aria-hidden=\"true\" focusable=\"false\" data-prefix=\"fas\" data-icon=\"step-backward\" class=\"svg-inline--fa fa-step-backward fa-w-14\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 448 512\"><path fill=\"currentColor\" d=\"M64 468V44c0-6.6 5.4-12 12-12h48c6.6 0 12 5.4 12 12v176.4l195.5-181C352.1 22.3 384 36.6 384 64v384c0 27.4-31.9 41.7-52.5 24.6L136 292.7V468c0 6.6-5.4 12-12 12H76c-6.6 0-12-5.4-12-12z\"></path></svg>\r\n      <span class=\"plyr__tooltip\">${this.configurator.i18n.previousEpisode}</span>\r\n      </button>`,\r\n      true,\r\n    );\r\n    // #endregion\r\n\r\n    // #region Embed playlist\r\n    /* Source:\r\n      https://stackoverflow.com/a/18602389\r\n      https://www.w3schools.com/jsref/met_node_clonenode.asp\r\n    Cấu trúc Playlist mới trong Player để overlay nút đóng playlist lên trên playlist:\r\n    // DOM structure in order to overlay close btn over embed playlist\r\n\r\n    <div class=\"embed-playlist\"> -> position: absolute -> chiếm trọn ô chứa Plyr | took over Plyr's container\r\n      <div> -> position: relative -> để cái nút đóng playlist hiện trên cùng | For overlaying close btn over embed playlist\r\n        <ul></ul> -> position: relative\r\n        <div>Nút đóng playlist | Hide embed playlist btn</div> -> position: absolute -> góc trên bên phải | sitting at top right corner of the embed playlist\r\n      </div>\r\n    </div>\r\n\r\n    */\r\n    this.insertBefore(\r\n      khpCtn.querySelector('.plyr>.plyr__control'),\r\n      this.string2Node(`<div class='EmbedKHPPlaylist hidden' key='${uniqueKey}'><div></div></div>`),\r\n    );\r\n    this.d(`.EmbedKHPPlaylist[key='${uniqueKey}']>div`).appendChild(this.d(`.KHPPlaylistContainer[key='${uniqueKey}']`).cloneNode(true));\r\n\r\n    // Nút ẩn/hiện embed playlist ở thanh điều khiển của Plyr\r\n    // Toggle embed playlist btn in Plyr's control bar\r\n    this.d(`.EmbedKHPPlaylist[key='${uniqueKey}']>div`).appendChild(this.string2Node(/* html */`\r\n      <div class=\"closeEmbed\">\r\n        <svg aria-hidden=\"true\" focusable=\"false\" data-prefix=\"fas\" data-icon=\"times-circle\" class=\"svg-inline--fa fa-times-circle fa-w-16\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 512 512\"><path fill=\"currentColor\" d=\"M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm121.6 313.1c4.7 4.7 4.7 12.3 0 17L338 377.6c-4.7 4.7-12.3 4.7-17 0L256 312l-65.1 65.6c-4.7 4.7-12.3 4.7-17 0L134.4 338c-4.7-4.7-4.7-12.3 0-17l65.6-65-65.6-65.1c-4.7-4.7-4.7-12.3 0-17l39.6-39.6c4.7-4.7 12.3-4.7 17 0l65 65.7 65.1-65.6c4.7-4.7 12.3-4.7 17 0l39.6 39.6c4.7 4.7 4.7 12.3 0 17L312 256l65.6 65.1z\"></path></svg>\r\n      </div>`));\r\n    this.d(`.EmbedKHPPlaylist[key='${uniqueKey}']>div>.KHPPlaylistContainer`).classList.remove('KHPPlaylistContainer');\r\n\r\n    // Event đóng embed playlist\r\n    // Event close embed playlist\r\n    khpCtn.querySelector(' .plyr__video-wrapper').addEventListener('click', () => {\r\n      this.toggleEmbedPlayllist(uniqueKey, true);\r\n    });\r\n    khpCtn.querySelector('.closeEmbed').addEventListener('click', () => {\r\n      this.toggleEmbedPlayllist(uniqueKey, true);\r\n    });\r\n    // #endregion\r\n  },\r\n  // Function đổi tập. Thay vì loop epindex như trước, gây một vài vấn đề về tương thích, mình tách luôn ra thành function riêng.\r\n\r\n  async changeEp(elem, epIndex) {\r\n    const\r\n      // Lấy uniqueKey từ <ul> đã nhồi nhét sẵn\r\n      uniqueKey = await elem.parentNode.getAttribute('key');\r\n    // Viết tắt của uniqueKeySelector\r\n    const khpCtn = this.id(uniqueKey);\r\n\r\n    // -- Highlight <li> đang phát --\r\n    // -- Highlight playing <li> --\r\n    for (const ep of khpCtn.querySelector('.KHPPlaylistContainer').querySelectorAll('li')) ep.removeAttribute('playing');\r\n    khpCtn.querySelectorAll('.KHPPlaylistContainer li')[epIndex].setAttribute('playing', '');\r\n    // #endregion\r\n\r\n    // -- Dữ liệu episode cần init --\r\n    // -- Episode's data need to init --\r\n    const currData = this.data[uniqueKey][epIndex];\r\n\r\n    // Chuyển từ tập này sang tập khác qua API .source của Plyr thì được, nhưng nhảy qua nhảy lại giữa source HLS với Plyr thì không. Cách giải quyết đơn giản nhất là destroy() luôn cái Plyr player đang phát rồi init lại cái mới.\r\n    // It's perfectly fine when switching between episodes using Plyr's .source API, but not when HLS get involved. So the quickest/easiest way is to destroy() current Plyr and init a new one.\r\n    this.plyr[uniqueKey][0].destroy();\r\n    this.plyr[uniqueKey] = await this.initPlyr(uniqueKey, currData.previewThumbnails);\r\n    this.tweaks(uniqueKey);\r\n\r\n    // Check dữ liệu xem dùng Plyr hay HLS để load dữ liệu.\r\n    // Check media type to determine using Plyr's API or HLS's one.\r\n    const currVideoTag = khpCtn.querySelector('video');\r\n    const currMedia = currData.sources[0];\r\n    if (currMedia.type.toUpperCase() === 'M3U8') {\r\n      this.m3u8(currVideoTag, currMedia.src);\r\n      // Không như Plyr, HLS chỉ có tác dụng load file m3u8, phụ đề phải thêm thủ công.\r\n      // Unlike Plyr, HLS only load m3u8 file, captions must be manually adding.\r\n      if (currData.tracks) {\r\n        for (const track of currData.tracks) this.addSubsForLibsPlayer(currVideoTag, track);\r\n      }\r\n    } else {\r\n      this.plyr[uniqueKey][0].source = currData;\r\n      this.plyr[uniqueKey][0].play();\r\n    }\r\n\r\n    // -- Giới hạn chiều cao của các danh sách chọn phụ đề, độ phân giải, tốc độ --\r\n    // #region -- Limit Plyr's menu height inside Plyr's div --\r\n    const limitPlyrListHeight = (type) => {\r\n      const\r\n        selectPlyr = khpCtn.querySelector('.plyr');\r\n      const typeSelect = selectPlyr.querySelector(`button[data-plyr=\"${type}\"]`);\r\n      if (typeSelect) {\r\n        const typeSelectCtn = typeSelect.parentNode;\r\n        const setMaxHeight = () => typeSelectCtn.style.maxHeight = `calc(${parseInt(window.getComputedStyle(selectPlyr).height, 10)}px - 105px)`;\r\n        setMaxHeight();\r\n        window.addEventListener('resize', () => setMaxHeight());\r\n        typeSelectCtn.style.overflow = 'auto';\r\n        typeSelectCtn.classList.add('custom_scrollbar');\r\n      }\r\n    };\r\n    const loopCheckMediaLoaded = setInterval(() => {\r\n      if (khpCtn.querySelector('.plyr video').readyState === 4) {\r\n        for (const item of ['language', 'speed', 'quality']) limitPlyrListHeight(item);\r\n        clearInterval(loopCheckMediaLoaded);\r\n      }\r\n    }, 500);\r\n    // #endregion\r\n\r\n    // -- Tự động next khi hết tập --\r\n    // #region -- Autoplay next episode --\r\n    this.plyr[uniqueKey][0].on('ended', function() {\r\n      // nextElementSubling/nextSibling: https://stackoverflow.com/a/24226603\r\n      const current_episode = KHPlayer.selectCurrEp(uniqueKey);\r\n      const next_episode = current_episode.nextElementSibling;\r\n      // Source: https://www.w3schools.com/jsref/met_html_click.asp\r\n      if (next_episode) next_episode.click();\r\n    });\r\n    // #endregion\r\n\r\n    // #region -- Lưu thời gian video đang xem mỗi 1 giây vào localStorage --\r\n    // Tạo interval rỗng -> clear đi -> tạo lại cái mới, tránh dẫn đến việc nhiều cái setInterval khác nhau mỗi khi đổi tập.\r\n    // Create empty interval -> clear -> create new one to avoid duplicate interval when switching episodes.\r\n    const historyPlayingIndicator = this.data[uniqueKey][this.data[uniqueKey].length - 1];\r\n    let saveCurrTimeEp = setInterval(function() { }, 1000);\r\n    clearInterval(saveCurrTimeEp);\r\n    saveCurrTimeEp = setInterval(() => {\r\n      if (khpCtn.querySelector('.plyr video').readyState === 4) {\r\n        localStorage.setItem('khplayer_playing_' + historyPlayingIndicator, JSON.stringify({\r\n          epIndex: epIndex,\r\n          time: Math.round(KHPlayer.plyr[uniqueKey][0].currentTime),\r\n        }));\r\n      }\r\n    }, 1000);\r\n    // #endregion\r\n\r\n    const adjustSpeed = () => {\r\n      // console.log(this.plyr[uniqueKey][0].speed);\r\n      if (event.shiftKey && event.keyCode == '190') this.plyr[uniqueKey][0].speed += 0.5;\r\n      if (event.shiftKey && event.keyCode == '188') this.plyr[uniqueKey][0].speed -= 0.5;\r\n    };\r\n    khpCtn.removeEventListener('keydown', adjustSpeed);\r\n    khpCtn.addEventListener('keydown', adjustSpeed);\r\n\r\n    // Source: https://github.com/richtr/NoSleep.js\r\n    // Giữ màn hình điện thoại luôn sáng khi đang phát\r\n    const noSleep = new NoSleep();\r\n    // this.plyr[uniqueKey][0].on('stopped', () => {\r\n    //     noSleep.disable();\r\n    //     console.log(\"paused\");\r\n    // });\r\n    // this.plyr[uniqueKey][0].on('playing', () => {\r\n    //     noSleep.enable();\r\n    // });\r\n    noSleep.enable();\r\n  },\r\n  toggleEmbedPlayllist(uniqueKey, hideOnly = false) {\r\n    const elem = this.d(`.EmbedKHPPlaylist[key='${uniqueKey}']`);\r\n    if (hideOnly) {\r\n      elem.classList.add('hidden');\r\n    } else {\r\n      if (elem.classList.contains('hidden')) {\r\n        elem.classList.remove('hidden');\r\n      } else {\r\n        elem.classList.add('hidden');\r\n      }\r\n    }\r\n  },\r\n  insertAfter(elem, data, string2Elem = false) {\r\n    // Source: https://github.com/nefe/You-Dont-Need-jQuery#3.7\r\n    if (elem) {\r\n      if (!string2Elem) elem.parentNode.insertBefore(data, elem.nextSibling);\r\n      if (string2Elem) elem.parentNode.insertBefore(this.string2Node(data), elem.nextSibling);\r\n    }\r\n  },\r\n  insertBefore(elem, data, string2Elem = false) {\r\n    if (string2Elem) elem.parentNode.insertBefore(this.string2Node(data), elem);\r\n    if (!string2Elem) elem.parentNode.insertBefore(data, elem);\r\n  },\r\n  selectCurrEp(uniqueKey) {\r\n    return this.d(`#${uniqueKey} .KHPPlaylistContainer li[playing]`);\r\n  },\r\n  navigateEp(elem, nextOrPrev) {\r\n    const uniqueKey = elem.parentNode.parentNode.parentNode.getAttribute('id');\r\n    const currEp = this.selectCurrEp(uniqueKey);\r\n    if (!currEp) document.querySelectorAll('#' + uniqueKey + ' .KHPPlaylistContainer li')[0].click();\r\n    if (currEp) {\r\n      const\r\n        nextEp = currEp.nextElementSibling;\r\n      const prevEp = currEp.previousElementSibling;\r\n      if (nextOrPrev === 'next') {\r\n        if (nextEp) nextEp.click();\r\n      }\r\n      if (nextOrPrev === 'prev') {\r\n        if (!prevEp) currEp.click();\r\n        if (prevEp) prevEp.click();\r\n      }\r\n    }\r\n  },\r\n  acceptContinue(uniqueKey, epIndex, time) {\r\n    const khpCtn = this.id(uniqueKey);\r\n    khpCtn.querySelectorAll(`.KHPPlaylistContainer li`)[epIndex].click();\r\n    const tempLoop = setInterval(() => {\r\n      if (khpCtn.querySelector(`.plyr video`).readyState === 4) {\r\n        KHPlayer.plyr[uniqueKey][0].currentTime = time;\r\n        clearInterval(tempLoop);\r\n      }\r\n    }, 100);\r\n  },\r\n  rejectContinue(elem) {\r\n    elem.parentNode.parentNode.parentNode.classList.add('hideAlert');\r\n    elem.parentNode.parentNode.parentNode.parentNode.querySelector('.plyr__controls').removeAttribute('hidden');\r\n  },\r\n  m3u8(elem, source) {\r\n    if (Hls.isSupported()) {\r\n      const hls = new Hls();\r\n      hls.loadSource(source);\r\n      hls.attachMedia(elem);\r\n      hls.on(Hls.Events.MANIFEST_PARSED, () => elem.play());\r\n    } else {\r\n      console.log(new Error('HLS.js is required for playback M3U8 media'));\r\n    }\r\n  },\r\n  // Source: http://youmightnotneedjquery.com/\r\n  getJSON(url) {\r\n    return new Promise((resolve) => {\r\n      let request = new XMLHttpRequest();\r\n      request.open('GET', url, true);\r\n      request.onreadystatechange = function() {\r\n        if (this.readyState === 4) {\r\n          if (this.status >= 200 && this.status < 400) {\r\n            resolve(JSON.parse(this.responseText));\r\n          } else {\r\n            resolve(void 0);\r\n          }\r\n        }\r\n      };\r\n      request.send();\r\n      request = null;\r\n    });\r\n  },\r\n  addSubsForLibsPlayer(elem, data) {\r\n    elem.appendChild(this.string2Node(`<track kind=\"subtitles\" label=\"${data.label}\" srclang=\"${data.srclang}\" src=\"${data.src}\">`));\r\n  },\r\n  // Source: https://stackoverflow.com/a/35385518\r\n  string2Node(html) {\r\n    const template = document.createElement('template');\r\n    html = html.trim(); // Never return a text node of whitespace as the result\r\n    template.innerHTML = html;\r\n    return template.content.firstChild;\r\n  },\r\n  // Source: https://developer.mozilla.org/en-US/docs/Web/API/Document/currentScript\r\n  loadCSS(url) {\r\n    const link = document.createElement('link');\r\n    link.rel = 'stylesheet';\r\n    link.type = 'text/css';\r\n    link.href = url;\r\n    document.head.appendChild(link);\r\n  },\r\n  loadJS(url, callback) {\r\n    // loadScript(url, callback) {\r\n    // return new Promise(resolve => {\r\n    const script = document.createElement('script');\r\n    script.type = 'text/javascript';\r\n    script.src = url;\r\n\r\n    // There are several events for cross browser compatibility.\r\n    script.onreadystatechange = callback;\r\n    script.onload = callback;\r\n\r\n    // Fire the loading\r\n    document.head.appendChild(script);\r\n    // });\r\n\r\n    // }\r\n  },\r\n  currNode: document.currentScript,\r\n  customConfigPath: document.currentScript.getAttribute('config'),\r\n  configurator: {\r\n    defaultQuality: 1080,\r\n    seekTime: 5,\r\n    invertTime: false,\r\n    captions: {\r\n      active: true,\r\n      language: 'auto',\r\n      update: true,\r\n    },\r\n    tooltips: {\r\n      controls: true,\r\n      seek: true,\r\n    },\r\n    defaultPoster: 'https://cdn.jsdelivr.net/gh/DELNEGEND/khplayer/dist/default_wating.svg',\r\n    blankVideo: 'https://cdn.jsdelivr.net/gh/DELNEGEND/khplayer/dist/blank.mp4',\r\n  },\r\n  // All videos' jsons' data\r\n  data: {},\r\n  // for Plyr to interact\r\n  plyr: {},\r\n};\r\ndocument.addEventListener('DOMContentLoaded', async () => {\r\n  const configURL = KHPlayer.customConfigPath;\r\n  let customConfigData = {};\r\n  let lang = {};\r\n  const lang_vi = {\r\n    i18n: {\r\n      restart: 'Khởi động lại',\r\n      rewind: 'Tua trước {seektime}s',\r\n      play: 'Phát',\r\n      pause: 'Tạm dừng',\r\n      fastForward: 'Tua tới {seektime}s',\r\n      seek: 'Tua',\r\n      seekLabel: '{currentTime} của {duration}',\r\n      played: 'Đã phát',\r\n      buffered: 'Đã tải trước',\r\n      currentTime: 'Thời gian bây giờ',\r\n      duration: 'Thời lượng',\r\n      volume: 'Âm lượng',\r\n      mute: 'Tắt tiếng',\r\n      unmute: 'Bật tiếng',\r\n      enableCaptions: 'Bật phụ đề',\r\n      disableCaptions: 'Tắt phụ đề',\r\n      download: 'Tải xuống',\r\n      enterFullscreen: 'Toàn màn hình',\r\n      exitFullscreen: 'Thoát toàn màn hình',\r\n      frameTitle: 'Trình phát cho {title}',\r\n      captions: 'Phụ đề',\r\n      settings: 'Cài đặt',\r\n      pip: 'PIP',\r\n      menuBack: 'Quay lại',\r\n      speed: 'Tốc độ',\r\n      normal: 'Bình thường',\r\n      quality: 'Chất lượng',\r\n      loop: 'Lặp',\r\n      start: 'Bắt đầu',\r\n      end: 'Kết thúc',\r\n      all: 'Tất cả',\r\n      reset: 'Khởi động lại',\r\n      disabled: 'Tắt',\r\n      enabled: 'Bật',\r\n      advertisement: 'Quảng cáo',\r\n      qualityBadge: {\r\n        2160: '4K',\r\n        1440: 'HD',\r\n        1080: 'HD',\r\n        720: 'HD',\r\n        576: 'SD',\r\n        480: 'SD',\r\n      },\r\n      nextEpisode: 'Tập tiếp theo',\r\n      previousEpisode: 'Tập trước',\r\n      toggleEmbedPlayllist: 'Danh sách tập',\r\n      continueWatchingConfirm: {\r\n        yes: 'Tiếp tục',\r\n        no: 'Xem từ đầu',\r\n        continueWatching: 'Đang xem',\r\n        at: 'tại',\r\n        confirm: '',\r\n      },\r\n    },\r\n  };\r\n  const lang_en = {\r\n    i18n: {\r\n      nextEpisode: 'Next episode',\r\n      previousEpisode: 'Previous episode',\r\n      toggleEmbedPlayllist: 'Episode list',\r\n      continueWatchingConfirm: {\r\n        yes: 'Continue',\r\n        no: 'Watch from begin',\r\n        continueWatching: 'You were watching',\r\n        at: 'at',\r\n        confirm: '',\r\n      },\r\n    },\r\n  };\r\n\r\n  if (configURL) customConfigData = await KHPlayer.getJSON(configURL) || {};\r\n\r\n  if (KHPlayer.currNode.getAttribute('vi') !== null) {\r\n    lang = lang_vi;\r\n  } else {\r\n    lang = lang_en;\r\n  }\r\n\r\n  KHPlayer.configurator = {\r\n    ...KHPlayer.configurator,\r\n    ...lang,\r\n    ...customConfigData,\r\n  };\r\n\r\n  if (KHPlayer.currNode.getAttribute('data')) {\r\n    KHPlayer.one();\r\n  } else {\r\n    for await (const elem of document.querySelectorAll('khplayer-container')) {\r\n      // Assign uniqueKey to avoid conflic between multiple khplayer-container when changeEp() or cloning playlist into embed playlist\r\n      // Gán uniqueKey để tránh xung đột với các khplayer-container khác khi chuyển tập hay clone playlist lên embed playlist\r\n      const uniqueKey = KHPlayer.randomString();\r\n      elem.setAttribute('id', uniqueKey);\r\n      KHPlayer.init(uniqueKey);\r\n    }\r\n  }\r\n});\r\n"],"file":"khplayer.js"}