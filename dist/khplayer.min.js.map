{"version":3,"sources":["khplayer.js"],"names":["KHPlayer","initPlyr","selector","Promise","resolve","Plyr","setup","seekTime","quality","default","captions","active","language","update","i18n","restart","rewind","play","pause","fastForward","seek","seekLabel","played","buffered","currentTime","duration","volume","mute","unmute","enableCaptions","disableCaptions","download","enterFullscreen","exitFullscreen","frameTitle","settings","pip","menuBack","speed","normal","loop","start","end","all","reset","disabled","enabled","advertisement","qualityBadge","2160","1440","1080","720","576","480","init","async","url","d","document","PLAYLIST_","getJSON","uniqueKey","length","uKs","PLAYLIST","poster","querySelector","innerHTML","setAttribute","index","currentID","currentVid","list_ep","createElement","appendChild","currentLine","getElementById","title","plyr","on","_insertBefore","htmlToElement","tweaks","insertAfter","cloneNode","event","localStorage","setItem","changeEp","elem","parseInt","getAttribute","parentNode","destroy","select_all","querySelectorAll","currLi","forEach","e","removeAttribute","style","color","currData","currVideoTag","sources","type","m3u8","src","tracks","addSubsForLibsPlayer","source","next_episode","nextElementSibling","click","getItem","console","log","setTimeout","fullscreen","enter","place","data","convertDataToElem","insertBefore","nextSibling","togglePlaylist","classList","toggle","selectCurrEp","navigateEp","nextOrPrev","currEp","nextEp","prevEp","previousElementSibling","Hls","isSupported","hls","loadSource","attachMedia","Events","MANIFEST_PARSED","reject","request","XMLHttpRequest","open","onreadystatechange","this","readyState","status","JSON","parse","responseText","Error","send","tempSub","label","srclang","html","template","trim","content","firstChild","jsonPaths","currentScript"],"mappings":"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","sourcesContent":["/*\r\nNOTE: concept là thế này:\r\n\r\nĐầu tiên client add 3 script: jQuery > Plyr.js > KHPlayer.js. Ở cái KHPjs kèm theo 1 attribute jsonPath, value là 1 array (tất nhiên là kiểu string, sau khi đem vào đây thì JSON.parse ra), đồng thời phải nhét thêm defer vào nữa\r\n\r\nArray chứa đường dẫn tới file JSON chứa dữ liệu của 1 tập hợp các video như: URL, phụ đề, tiêu đề, độ phân giải, poster, abcxyz... Mình gọi array trong file JSON này là Array mẹ (để dễ ghi note ở dưới)\r\n\r\nElement cuối của Array mẹ là một uniqueKey, client cần đặt thẻ div có ID này ở nơi họ muốn generate player.\r\n\r\nChạy hàm addingCSSandStuffs để add CSS của KHPlayer và của Plyr, đồng thời check version và console.log version.\r\n*/\r\n// jshint esversion: 10 \r\nconst KHPlayer = {\r\n\r\n  // Khởi tạo Plyr\r\n  initPlyr: function (selector) {\r\n    return new Promise(function (resolve) {\r\n      resolve(Plyr.setup(selector, {\r\n        seekTime: 5,\r\n        quality: {\r\n          default: 1080\r\n        },\r\n        captions: {\r\n          active: true,\r\n          language: 'auto',\r\n          update: true\r\n        },\r\n        i18n: {\r\n          restart: 'Khởi động lại',\r\n          rewind: 'Tua trước {seektime}s',\r\n          play: 'Phát',\r\n          pause: 'Tạm dừng',\r\n          fastForward: 'Tua tới {seektime}s',\r\n          seek: 'Tua',\r\n          seekLabel: '{currentTime} của {duration}',\r\n          played: 'Đã phát',\r\n          buffered: 'Đã tải trước',\r\n          currentTime: 'Thời gian bây giờ',\r\n          duration: 'Thời lượng',\r\n          volume: 'Âm lượng',\r\n          mute: 'Tắt tiếng',\r\n          unmute: 'Bật tiếng',\r\n          enableCaptions: 'Bật phụ đề',\r\n          disableCaptions: 'Tắt phụ đề',\r\n          download: 'Tải xuống',\r\n          enterFullscreen: 'Toàn màn hình',\r\n          exitFullscreen: 'Thoát toàn màn hình',\r\n          frameTitle: 'Trình phát cho {title}',\r\n          captions: 'Phụ đề',\r\n          settings: 'Cài đặt',\r\n          pip: 'PIP',\r\n          menuBack: 'Quay lại',\r\n          speed: 'Tốc độ',\r\n          normal: 'Bình thường',\r\n          quality: 'Chất lượng',\r\n          loop: 'Lặp',\r\n          start: 'Bắt đầu',\r\n          end: 'Kết thúc',\r\n          all: 'Tất cả',\r\n          reset: 'Khởi động lại',\r\n          disabled: 'Tắt',\r\n          enabled: 'Bật',\r\n          advertisement: 'Quảng cáo',\r\n          qualityBadge: {\r\n            2160: '4K',\r\n            1440: 'HD',\r\n            1080: 'HD',\r\n            720: 'HD',\r\n            576: 'SD',\r\n            480: 'SD',\r\n          },\r\n        },\r\n        // debug: true\r\n      }));\r\n    });\r\n  },\r\n\r\n  // Khởi tạo KHPlayer ở đây\r\n  // NOTE: chính bởi vì ở func đổi tập, mình lựa chọn cách destroy cái cũ đi và init lại cái mới, những eventListener đối với cái KHPforPlyrToInteract cũng sẽ bị destroy theo. Vì vậy hãy add listener vào trong func đổi tập (ví dụ như cái auto next tập kia chẳng hạn)\r\n  init: async function (url) {\r\n\r\n    /* NOTE: Mỗi playlist (Array mẹ), mỗi Container (cái mà client paste vào HTML), mỗi object để Plyr tương tác đều được gán thêm uniqueKey để có thể có nhiều player mà không bị conflict lẫn nhau */\r\n\r\n    let\r\n      d = document,\r\n      PLAYLIST_ = await KHPlayer.getJSON(url),\r\n      uniqueKey = await PLAYLIST_[PLAYLIST_.length - 1],\r\n      uKs = \"#\" + uniqueKey;\r\n    KHPlayer[\"KHPPlaylist\" + uniqueKey] = PLAYLIST_;\r\n    PLAYLIST = KHPlayer[\"KHPPlaylist\" + uniqueKey];\r\n\r\n    let\r\n      // elem sát cuối là url poster tổng\r\n      poster = await PLAYLIST[PLAYLIST.length - 2];\r\n    // Cái này vì mình dùng jQuery nên gắn # vào cho nhanh\r\n\r\n    // Tạo 1 cái frame bên trong container player\r\n    d.querySelector(\"#\" + uniqueKey).innerHTML = `\r\n        <video control playsinline></video>\r\n        <ul key=\"${uniqueKey}\" class='KHPPlaylistContainer'></ul>`;\r\n    // Set poster\r\n    d.querySelector(uKs + \" video\").setAttribute(\"poster\", poster);\r\n\r\n    // Khởi tạo playlist\r\n    // Cái này để check playlist có trống hay không, mà hình như có vẻ thừa thãi :)))\r\n    if (PLAYLIST.length > 0) {\r\n      // Để index bắt đầu từ 0\r\n      let index = 0;\r\n      // Biến Array mẹ thành GUI, một list chứa các episode\r\n      while (index <= PLAYLIST.length - 3) {\r\n        let\r\n          // Tạo id cho từ mục một\r\n          currentID = +index,\r\n          // Gọi data của từng elem trong array \"tổng\" xuống\r\n          currentVid = PLAYLIST[index],\r\n          // Giờ mới create elem\r\n          list_ep = d.createElement(\"li\");\r\n        list_ep.setAttribute(\"index\", currentID);\r\n        // Append mục chọn tập vào container\r\n        d.querySelector(`#${uniqueKey} .KHPPlaylistContainer`).appendChild(list_ep); //jshint ignore:line\r\n        // Gọi mục chọn tập lên\r\n        let currentLine = d.getElementById(uniqueKey).querySelector(\"li[index='\" + currentID + \"'\");\r\n        // Gán cho nó cái nội dung (gọi title từ currentVid lên array tổng xuống)\r\n        currentLine.innerHTML = currentVid.title;\r\n        // function đổi tập\r\n        currentLine.setAttribute(\"onclick\", `KHPlayer.changeEp(this)`);\r\n        // Tăng index ở phía trên lên 1, tiếp tục cho mục chọn tiếp theo\r\n        index++;\r\n      }\r\n    }\r\n    // NOTE: Plyr đc khởi tạo ở chỗ này\r\n    KHPlayer.plyr[uniqueKey] = await KHPlayer.initPlyr(uKs + \" video\");\r\n\r\n    // Cái này chỉ được chạy đúng lần, cho đến khi\r\n    KHPlayer.plyr[uniqueKey][0].on(\"play\", function () {\r\n      KHPlayer._insertBefore(\r\n        uKs + ' .plyr__video-wrapper video',\r\n        KHPlayer.htmlToElement(\"<div>a</div>\")\r\n      );\r\n    });\r\n    KHPlayer.tweaks(uniqueKey);\r\n\r\n  },\r\n\r\n  // Khởi chạy mỗi Plyr được khởi tạo lại, hay mỗi lần đổi tập bởi cái destroy() rồi init lại trong cáo changeEp, lý do vì sao cũng đã giải thích ở dới đó\r\n  tweaks: function (uniqueKey) {\r\n    let d = document,\r\n      // uniqueKeySelector\r\n      uKs = \"#\" + uniqueKey;\r\n\r\n    // NOTE: Đã chuyển sang sử dụng KHPlayer.insertAfter\r\n    // // Nút biểu tượng cài đặt (menu) trên thanh control của player\r\n    // let plyrMenuBtn = d.querySelector(uKs + \" .plyr__controls>.plyr__menu\");\r\n    // // Chọn nút menu > chỉ đến parent của nó > thêm nút toggle danh sách tập vào trong parent nhưng đằng trước phần tử đứng sau cái menu, tức thêm vào trước menu\r\n    // // Source: https://github.com/nefe/You-Dont-Need-jQuery#3.7\r\n    // plyrMenuBtn.parentNode.insertBefore(\r\n    //   KHPlayer.htmlToElement(\r\n    //     `<button class=\"plyr__controls__item plyr__control togglePlaylist\" type=\"button\" onclick=\"KHPlayer.togglePlaylist('${uniqueKey}')\"><i class=\"fas fa-bars\"></i></button>`),\r\n    //   plyrMenuBtn.nextSibling\r\n    // ); \r\n\r\n    // Nút ẩn/hiện embed playlistCtn\r\n    // <i class=\"fas fa-bars fa-lg\"></i>\r\n    KHPlayer.insertAfter(\r\n      uKs + \" .plyr__controls>.plyr__menu\",\r\n      `<button class=\"plyr__controls__item plyr__control customBtn\" type=\"button\" onclick=\"KHPlayer.togglePlaylist('${uniqueKey}')\">\r\n      <svg aria-hidden=\"true\" focusable=\"false\" data-prefix=\"fas\" data-icon=\"list-ul\" class=\"svg-inline--fa fa-list-ul fa-w-16\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 512 512\"><path fill=\"currentColor\" d=\"M48 48a48 48 0 1 0 48 48 48 48 0 0 0-48-48zm0 160a48 48 0 1 0 48 48 48 48 0 0 0-48-48zm0 160a48 48 0 1 0 48 48 48 48 0 0 0-48-48zm448 16H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-320H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16zm0 160H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16z\"></path></svg></button>`,\r\n      true\r\n    );\r\n    // Nút next tập\r\n    // <i class=\"fas fa-step-forward fa-lg\"></i>\r\n    KHPlayer.insertAfter(\r\n      uKs + \" .plyr__controls > button:nth-child(1)\",\r\n      `<button class=\"plyr__controls__item plyr__control customBtn\" type=\"button\" onclick=\"KHPlayer.navigateEp(this,'next')\">\r\n      <svg aria-hidden=\"true\" focusable=\"false\" data-prefix=\"fas\" data-icon=\"step-forward\" class=\"svg-inline--fa fa-step-forward fa-w-14\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 448 512\"><path fill=\"currentColor\" d=\"M384 44v424c0 6.6-5.4 12-12 12h-48c-6.6 0-12-5.4-12-12V291.6l-195.5 181C95.9 489.7 64 475.4 64 448V64c0-27.4 31.9-41.7 52.5-24.6L312 219.3V44c0-6.6 5.4-12 12-12h48c6.6 0 12 5.4 12 12z\"></path></svg></button>`,\r\n      true\r\n    );\r\n    // Nút previous tập\r\n    // <i class=\"fas fa-step-backward fa-lg\"></i>\r\n    KHPlayer._insertBefore(\r\n      uKs + \" .plyr__controls > button:nth-child(1)\",\r\n      `<button class=\"plyr__controls__item plyr__control customBtn\" type=\"button\" onclick=\"KHPlayer.navigateEp(this,'prev')\">\r\n      <svg aria-hidden=\"true\" focusable=\"false\" data-prefix=\"fas\" data-icon=\"step-backward\" class=\"svg-inline--fa fa-step-backward fa-w-14\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 448 512\"><path fill=\"currentColor\" d=\"M64 468V44c0-6.6 5.4-12 12-12h48c6.6 0 12 5.4 12 12v176.4l195.5-181C352.1 22.3 384 36.6 384 64v384c0 27.4-31.9 41.7-52.5 24.6L136 292.7V468c0 6.6-5.4 12-12 12H76c-6.6 0-12-5.4-12-12z\"></path></svg>\r\n      </button>`,\r\n      true\r\n    );\r\n    /*Thêm KHPPlaylistContainer vào trong container chứa <video> (để overlay)\r\n      Source:\r\n        https://stackoverflow.com/questions/16234740/overlay-on-html5-fullscreen-video\r\n        https://www.w3schools.com/jsref/met_node_clonenode.asp\r\n    */\r\n    KHPlayer._insertBefore(\r\n      uKs + ' .plyr__video-wrapper video',\r\n      d.querySelector(`.KHPPlaylistContainer[key='${uniqueKey}']`).cloneNode(true)\r\n    );\r\n    d.querySelector(uKs + \" .plyr__video-wrapper .KHPPlaylistContainer\").setAttribute(\"class\", \"EmbedKHPPlaylist hideEmbedKHPPlaylist\");\r\n\r\n    // Source: https://www.w3schools.com/jsref/prop_win_localstorage.asp\r\n    KHPlayer.plyr[uniqueKey][0].on(\"enterfullscreen\", event => {\r\n      localStorage.setItem(\"FullScreen\" + uniqueKey, \"enterFull\");\r\n    });\r\n    KHPlayer.plyr[uniqueKey][0].on(\"exitfullscreen\", event => {\r\n      localStorage.setItem(\"FullScreen\" + uniqueKey, \"exitFull\");\r\n    });\r\n  },\r\n\r\n  // Function đổi tập. Thay vì loop epindex như trước, gây một vài vấn đề về tương thích, mình gán luôn function vào mỗi <li> trong DOM, kèm theo this\r\n  changeEp: async function (elem) {\r\n    // Lấy index của tập từ attribute \"index\" luôn\r\n    let index = parseInt(elem.getAttribute('index'), 10),\r\n      // Lấy uniqueKey từ <ul> đã nhồi nhét sẵn\r\n      uniqueKey = await elem.parentNode.getAttribute(\"key\"),\r\n      // Viết tắt của uniqueKeySelector\r\n      uKs = \"#\" + uniqueKey,\r\n      currPlyr = 'KHPforPlyrToInteract' + uniqueKey;\r\n\r\n    // Thường thì chỉ cần .source thôi là đủ (để chuyển tập), nhưng khi sử dụng nguồn m3u8, phải sử dụng API của HLS, source HLS mới chồng chéo lên source Plyr cũ. Cách giải quyết là destroy luôn cái cũ đi rồi init cái mới\r\n    KHPlayer.plyr[uniqueKey][0].destroy();\r\n    KHPlayer.plyr[uniqueKey][0] = await KHPlayer.initPlyr(uKs + \" video\");\r\n\r\n    // Chọn toàn bộ các <li> trong <ul> danh sách tập\r\n    select_all = document.querySelector(uKs + \" .KHPPlaylistContainer\").querySelectorAll(\"li\");\r\n    let currLi = document.querySelector(`${uKs} .KHPPlaylistContainer li[index='${index}']`);\r\n    // Xoá style (làm nổi bật <li> hiện đang phát) và indicator cái trước\r\n    select_all.forEach(function (e) {\r\n      e.removeAttribute(\"playing\");\r\n      e.removeAttribute(\"style\");\r\n    });\r\n    // Sau đó add lại cho cái cái vừa click\r\n    currLi.style.color = \"yellow\";\r\n    currLi.setAttribute(\"playing\", \"true\");\r\n\r\n    let currData = KHPlayer[\"KHPPlaylist\" + uniqueKey][index],\r\n      currVideoTag = document.querySelector(uKs + \" video\"),\r\n      currMediaType = currData.sources[0].type;\r\n\r\n    // Handle phần source đưa vào player. Nếu là M3U8 thì sử dụng HLS để thêm source, đồng thời thêm captions (nếu có)\r\n    if (currMediaType === \"M3U8\") {\r\n      KHPlayer.m3u8(currVideoTag, currData.sources[0].src);\r\n      if (currData.tracks != void 0) {\r\n        KHPlayer.addSubsForLibsPlayer(uKs + \" video\", currData.tracks[0]);\r\n      }\r\n      // Còn không thì dùng luôn API của Plyr, khỏi cần thêm cái addCaptions như trên\r\n    } else {\r\n      KHPlayer.plyr[uniqueKey][0].source = currData;\r\n     KHPlayer.plyr[uniqueKey][0].play();\r\n    }\r\n\r\n    // Tự động next khi hết tập\r\n    // Đầu tiên đặt cái on(\"ended\") (theo API của Plyr)\r\n   KHPlayer.plyr[uniqueKey][0].on('ended', function () {\r\n      // Lấy tập đang phát dựa vào cái indicator đã thêm ở trên > select tập tiếp theo > nếu tồn tại (!= void 0) thì click vào đó.\r\n      // Về vụ nextElementSubling hay nextSibling: https://stackoverflow.com/questions/24226571/what-is-the-difference-between-node-nextsibling-and-childnode-nextelementsibling\r\n      let current_episode = document.querySelectorAll(\"#\" + uniqueKey + \" li[playing='true']\")[1],\r\n        next_episode = current_episode.nextElementSibling;\r\n      if (next_episode != void 0) {\r\n        // Source: https://www.w3schools.com/jsref/met_html_click.asp\r\n        next_episode.click();\r\n      }\r\n    });\r\n\r\n    if (localStorage.getItem(\"FullScreen\" + uniqueKey) === \"enterFull\") {\r\n      console.log(\"changeOnFull\");\r\n      setTimeout(() => {\r\n       KHPlayer.plyr[uniqueKey][0].fullscreen.enter();\r\n      }, 5);\r\n    }\r\n\r\n    KHPlayer.tweaks(uniqueKey);\r\n  },\r\n  insertAfter: function (place, data, convertDataToElem = false) {\r\n    // Source: https://github.com/nefe/You-Dont-Need-jQuery#3.7\r\n    let elem = document.querySelector(place);\r\n    if (convertDataToElem === false) {\r\n      elem.parentNode.insertBefore(data, elem.nextSibling);\r\n    } else if (convertDataToElem === true) {\r\n      elem.parentNode.insertBefore(KHPlayer.htmlToElement(data), elem.nextSibling);\r\n    }\r\n  },\r\n  // Tránh confict với insertBefore của javascript\r\n  _insertBefore: function (place, data, convertDataToElem = false) {\r\n    let elem = document.querySelector(place);\r\n    if (convertDataToElem === false) {\r\n      elem.parentNode.insertBefore(data, elem);\r\n    } else if (convertDataToElem === true) {\r\n      elem.parentNode.insertBefore(KHPlayer.htmlToElement(data), elem);\r\n    }\r\n  },\r\n  togglePlaylist: function (uniqueKey) {\r\n    /* Source:\r\n      https://www.w3schools.com/howto/howto_js_toggle_class.asp\r\n      https://stackoverflow.com/questions/16176648/trying-to-do-a-css-transition-on-a-class-change\r\n    */\r\n    document.querySelector(\"#\" + uniqueKey + \" .EmbedKHPPlaylist\").classList.toggle(\"hideEmbedKHPPlaylist\");\r\n  },\r\n  selectCurrEp: function (uniqueKey) {\r\n    return document.querySelector(`#${uniqueKey} .KHPPlaylistContainer li[playing='true']`);\r\n  },\r\n  navigateEp: function (elem, nextOrPrev) {\r\n    let uniqueKey = elem.parentNode.parentNode.parentNode.getAttribute(\"id\"),\r\n      currEp = KHPlayer.selectCurrEp(uniqueKey);\r\n    if (currEp === null) document.querySelector(\"#\" + uniqueKey + \" .KHPPlaylistContainer li[index='0']\").click();\r\n    if (currEp !== null) {\r\n      let\r\n        nextEp = currEp.nextElementSibling,\r\n        prevEp = currEp.previousElementSibling;\r\n      if (nextOrPrev === \"next\") {\r\n        if (nextEp !== null) nextEp.click();\r\n      }\r\n      if (nextOrPrev === \"prev\") {\r\n        prevEp === null ? currEp.click() : prevEp.click(); //jshint ignore:line\r\n      }\r\n    }\r\n  },\r\n  // prevEp: function () {\r\n  //   let uniqueKey = elem.parentNode.parentNode.parentNode.getAttribute(\"id\");\r\n  // },\r\n  // Source: http://youmightnotneedjquery.com/\r\n  m3u8: function (elem, source) {\r\n    if (Hls.isSupported()) {\r\n      var hls = new Hls();\r\n      hls.loadSource(source);\r\n      hls.attachMedia(elem);\r\n      hls.on(Hls.Events.MANIFEST_PARSED, function () {\r\n        elem.play();\r\n      });\r\n    }\r\n  },\r\n  getJSON: function (url) {\r\n    return new Promise(function (resolve, reject) {\r\n      var request = new XMLHttpRequest();\r\n      request.open('GET', url, true);\r\n      request.onreadystatechange = function () {\r\n        if (this.readyState === 4) {\r\n          if (this.status >= 200 && this.status < 400) {\r\n            var data = JSON.parse(this.responseText);\r\n            resolve(data);\r\n          } else {\r\n            reject(new Error(\"Double check JSON path/url\"));\r\n          }\r\n        }\r\n      };\r\n      request.send();\r\n      request = null;\r\n    });\r\n  },\r\n  addSubsForLibsPlayer: function (elem, data) {\r\n    let tempSub = `<track kind=\"subtitles\" label=\"${data.label}\" srclang=\"${data.srclang}\" src=\"${data.src}\">`;\r\n    document.querySelector(elem).appendChild(KHPlayer.htmlToElement(tempSub));\r\n  },\r\n  // Source: https://stackoverflow.com/questions/494143/creating-a-new-dom-element-from-an-html-string-using-built-in-dom-methods-or-pro/35385518#35385518\r\n  htmlToElement: function (html) {\r\n    var template = document.createElement('template');\r\n    html = html.trim(); // Never return a text node of whitespace as the result\r\n    template.innerHTML = html;\r\n    return template.content.firstChild;\r\n  },\r\n  // loadCSSfromURL: function () {\r\n  //   // Source: https://developer.mozilla.org/vi/docs/Web/JavaScript/Reference/Functions/arguments\r\n  //   for (let i = 0; i < arguments.length; i++) {\r\n  //     document.getElementsByTagName(\"head\")[0].appendChild(KHPlayer.htmlToElement(`<link rel=\"stylesheet\" href=\"${arguments[i]}\">`))\r\n  //   }\r\n  // },\r\n  // Source: https://developer.mozilla.org/en-US/docs/Web/API/Document/currentScript\r\n  jsonPaths: JSON.parse(document.currentScript.getAttribute(\"jsonPath\")),\r\n  // Chứa dữ liệu từ file json mà người dùng load\r\n  data: {},\r\n  // Các <video> đẻ plyr tương tác\r\n  plyr: {}\r\n};\r\n// if (JSON.parse(document.currentScript.getAttribute(\"fa\") != \"false\")) {\r\n//   KHPlayer.loadCSSfromURL(\"https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.13.0/css/all.min.css\");\r\n// }\r\n// KHPlayer.loadCSSfromURL(\r\n//   \"https://cdn.jsdelivr.net/gh/sampotts/plyr@3.6.2/dist/plyr.css\",\r\n//   // \"https://cdn.jsdelivr.net/gh/DELNEGEND/khplayer@4.0/dist/khplayer.min.css\"\r\n// );\r\nKHPlayer.jsonPaths.forEach(function (e) {\r\n  KHPlayer.init(e);\r\n});\r\n// confirm('hello');"],"file":"khplayer.min.js"}