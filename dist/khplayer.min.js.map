{"version":3,"sources":["khplayer.js"],"names":["KHPlayer","d","document","[object Object]","e","this","querySelector","getElementById","length","result","characters","charactersLength","i","charAt","Math","floor","random","btoa","Date","getTime","replace","uniqueKey","previewThumbnails","customConfig","Object","assign","configurator","enabled","src","Promise","resolve","Plyr","setup","khpCtn","id","data","getJSON","getAttribute","PLAYLIST","poster","defaultPoster","historyPlayingIndicator","innerHTML","setAttribute","index","elem","createElement","title","appendChild","plyr","initPlyr","tweaks","playingData","localStorage","getItem","playingDataJSON","JSON","parse","confirmi18n","i18n","continueWatchingConfirm","insertAfter","continueWatching","epIndex","at","time","toISOString","substr","confirm","yes","no","toggleEmbedPlayllist","nextEpisode","insertBefore","previousEpisode","string2Node","s","cloneNode","classList","remove","addEventListener","parentNode","ep","querySelectorAll","removeAttribute","currData","destroy","currVideoTag","currMedia","sources","type","toUpperCase","m3u8","tracks","track","addSubsForLibsPlayer","source","play","limitPlyrListHeight","selectPlyr","typeSelect","typeSelectCtn","setMaxHeight","style","maxHeight","parseInt","window","getComputedStyle","height","overflow","add","loopCheckMediaLoaded","setInterval","readyState","item","clearInterval","on","next_episode","selectCurrEp","nextElementSibling","click","saveCurrTimeEp","setItem","stringify","round","currentTime","adjustSpeed","event","shiftKey","keyCode","speed","removeEventListener","hideOnly","contains","string2Elem","nextSibling","nextOrPrev","currEp","nextEp","prevEp","previousElementSibling","tempLoop","Hls","isSupported","hls","loadSource","attachMedia","Events","MANIFEST_PARSED","console","log","Error","url","request","XMLHttpRequest","open","onreadystatechange","status","responseText","send","label","srclang","html","template","trim","content","firstChild","customConfigPath","currentScript","async","customConfigData","configURL","configData","defaultQuality","seekTime","invertTime","captions","active","language","update","tooltips","controls","seek","blankVideo","restart","rewind","pause","fastForward","seekLabel","played","buffered","duration","volume","mute","unmute","enableCaptions","disableCaptions","download","enterFullscreen","exitFullscreen","frameTitle","settings","pip","menuBack","normal","quality","loop","start","end","all","reset","disabled","advertisement","qualityBadge","2160","1440","1080","720","576","480","randomString","init"],"mappings":"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","sourcesContent":["//! ================================================\r\n//! KHPLayer\r\n//! Version: 6.0\r\n//! Homepage/repo: https://khplayer.delnegend.xyz --redirect--> https://github.com/DELNEGEND/khplayer\r\n//! License: The MIT License (MIT)\r\n//! ================================================\r\n// jshint esversion: 9\r\n// jshint expr:true\r\n\r\nconst KHPlayer = {\r\n  // Syntax lát nữa dùng ngắn hơn\r\n  // Sorter syntax for later use\r\n  d: document,\r\n  s(e) {\r\n    return this.d.querySelector(e);\r\n  },\r\n  id(e) {\r\n    return this.d.getElementById(e);\r\n  },\r\n  // Source: https://stackoverflow.com/a/1349426\r\n  randomString(length = 20) {\r\n    let result = '';\r\n    let characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\r\n    let charactersLength = characters.length;\r\n    for (let i = 0; i < length; i++) result += characters.charAt(Math.floor(Math.random() * charactersLength));\r\n    return \"_\" + result + btoa(new Date().getTime()).replace(/=/g, \"\");\r\n  },\r\n  // Init Plyr\r\n  // Khởi tạo Plyr\r\n  initPlyr(uniqueKey, previewThumbnails = false) {\r\n    // Nếu trong episode cần init có url prevThumbnails thì thêm prevThumb vào customConfig được clone từ config gốc hẵng init, tránh thêm prevThumb vào config gốc.\r\n    // If prevThumbnails's url exist in need-to-init episode, add it into customConfig - cloned from the original config to avoid adding into the original one\r\n    let customConfig = Object.assign({}, this.configurator);\r\n    if (previewThumbnails) {\r\n      customConfig.previewThumbnails = {\r\n        enabled: true,\r\n        src: previewThumbnails.src\r\n      };\r\n    }\r\n    return new Promise(function (resolve) {\r\n      resolve(Plyr.setup(\"#\" + uniqueKey + \" video\", customConfig));\r\n    });\r\n  },\r\n  // Hàm khởi tạo KHPlayer ở đây\r\n  // NOTE: ở changeEp(), Plyr được destroy() và init(), những gì -liên quan tới/nằm trong- nó cũng bị phá huỷ theo (embed playlist, các nút toggle, eventListener...). Phần init này chỉ chạy lần đầu tiên để khởi tạo những thứ ngoài tầm với của Plyr, vì vậy nếu có thêm tính năng nào đối với Plyr thì hãy thêm vào phần changeEp\r\n\r\n  // KHPlayer init() here\r\n  // NOTE: in changeEp(), Plyr get destroy() and init() again with new data, anything that -related to/sit inside- Plyr are also destroyed (embed playlist and its toggle btn, next/prev btn, eventListener...), This init() only run once to initiate stuffs outside Plyr's reach, so if you're planning to add any button into Plyr's container or an eventListener, consider using changeEp() or tweaks()\r\n  async init(uniqueKey) {\r\n    let\r\n      khpCtn = this.id(uniqueKey);\r\n    // Gán dữ liệu vào KHPLayer để lát chuyển tập dùng lại\r\n    // Assign data into KHPlayer for re-using in changeEp()\r\n    this.data[uniqueKey] = await this.getJSON(khpCtn.getAttribute(\"data\"));\r\n    // Syntax ngắn hơn\r\n    // Shorter syntax\r\n    PLAYLIST = this.data[uniqueKey];\r\n    // Getting poster and playingIndicator\r\n    // Lấy url Poster, playingIndicator\r\n    let poster = PLAYLIST[PLAYLIST.length - 2] || this.configurator.defaultPoster,\r\n      historyPlayingIndicator = PLAYLIST[PLAYLIST.length - 1];\r\n    // Create a frame for Plyr to init\r\n    // Tạo 1 cái frame cho Plyr bên trong container player\r\n    khpCtn.innerHTML = `\r\n        <video control playsinline></video>\r\n        <ul key=\"${uniqueKey}\" class='KHPPlaylistContainer custom_scrollbar'></ul>`;\r\n    // Set poster\r\n    khpCtn.querySelector(\"video\").setAttribute(\"poster\", poster);\r\n    // Tạo playlist dựa trên dữ liệu JSON\r\n    // Create playlist based on JSON data\r\n    for (let index = 0; index < PLAYLIST.length - 2; index++) {\r\n      let\r\n        elem = this.d.createElement(\"li\");\r\n      elem.setAttribute(\"onclick\", `KHPlayer.changeEp(this,${index})`);\r\n      elem.innerHTML = PLAYLIST[index].title;\r\n      khpCtn.querySelector(`.KHPPlaylistContainer`).appendChild(elem);\r\n    }\r\n\r\n    // -- Plyr đc khởi tạo ở chỗ này --\r\n    // -- Plyr get init here --\r\n    this.plyr[uniqueKey] = await this.initPlyr(uniqueKey);\r\n    this.tweaks(uniqueKey);\r\n\r\n    // -- Phần này detect lịch sử xem --\r\n    // #region -- Detect watching history --\r\n    let playingData = localStorage.getItem(\"khplayer_playing_\" + historyPlayingIndicator);\r\n    if (playingData) {\r\n      let playingDataJSON = JSON.parse(playingData),\r\n        confirmi18n = this.configurator.i18n.continueWatchingConfirm;\r\n      // Source: timestamp --> regular: https://stackoverflow.com/a/25279340\r\n      this.insertAfter(\r\n        khpCtn.querySelector('.plyr>.plyr__control'),\r\n        `<div class=\"systemDetectHistory\">\r\n          <div class=\"text\">${confirmi18n.continueWatching} ${KHPlayer.data[uniqueKey][playingDataJSON.epIndex].title} ${confirmi18n.at} ${new Date(playingDataJSON.time * 1000).toISOString().substr(11, 8)}${confirmi18n.confirm}</div>\r\n          <div class=\"actions\">\r\n            <div class=\"confirmBtn\">\r\n              <div onclick='KHPlayer.acceptContinue(\"${uniqueKey}\", ${playingDataJSON.epIndex}, ${playingDataJSON.time})' class=\"buttonInner\">${confirmi18n.yes}</div>\r\n            </div>\r\n            <div class=\"confirmBtn\">\r\n              <div onclick='KHPlayer.rejectContinue(this)' class=\"buttonInner\">${confirmi18n.no}</div>\r\n            </div>\r\n          </div>\r\n        </div>`,\r\n        true\r\n      );\r\n      khpCtn.querySelector('.plyr>.plyr__controls').setAttribute('hidden', \"\");\r\n    }\r\n    //#endregion\r\n  },\r\n  // \r\n  tweaks(uniqueKey) {\r\n    let khpCtn = this.id(uniqueKey);\r\n\r\n    // Thêm vài nút chức năng vào Plyr\r\n    // #region adding a few button into Plyr's container \r\n\r\n    // Nút ẩn/hiện embed playlist\r\n    // Toggle embed playlist btn\r\n    // <i class=\"fas fa-bars fa-lg\"></i>\r\n    this.insertAfter(\r\n      khpCtn.querySelector(\".plyr__controls>.plyr__menu\"),\r\n      `<button class=\"plyr__controls__item plyr__control customBtn\" type=\"button\" onclick=\"KHPlayer.toggleEmbedPlayllist('${uniqueKey}')\">\r\n      <svg aria-hidden=\"true\" focusable=\"false\" data-prefix=\"fas\" data-icon=\"list-ul\" class=\"svg-inline--fa fa-list-ul fa-w-16\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 512 512\"><path fill=\"currentColor\" d=\"M48 48a48 48 0 1 0 48 48 48 48 0 0 0-48-48zm0 160a48 48 0 1 0 48 48 48 48 0 0 0-48-48zm0 160a48 48 0 1 0 48 48 48 48 0 0 0-48-48zm448 16H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-320H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16zm0 160H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16z\"></path></svg>\r\n      <span class=\"plyr__tooltip\">${this.configurator.i18n.toggleEmbedPlayllist}</span>\r\n      </button>`,\r\n      true\r\n    );\r\n    // Nút next tập\r\n    // Next episode btn\r\n    // <i class=\"fas fa-step-forward fa-lg\"></i>\r\n    this.insertAfter(\r\n      khpCtn.querySelector(\".plyr__controls > button:nth-child(1)\"),\r\n      `<button class=\"plyr__controls__item plyr__control customBtn nextEpBtn\" type=\"button\" onclick=\"KHPlayer.navigateEp(this,'next')\">\r\n      <svg aria-hidden=\"true\" focusable=\"false\" data-prefix=\"fas\" data-icon=\"step-forward\" class=\"svg-inline--fa fa-step-forward fa-w-14\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 448 512\"><path fill=\"currentColor\" d=\"M384 44v424c0 6.6-5.4 12-12 12h-48c-6.6 0-12-5.4-12-12V291.6l-195.5 181C95.9 489.7 64 475.4 64 448V64c0-27.4 31.9-41.7 52.5-24.6L312 219.3V44c0-6.6 5.4-12 12-12h48c6.6 0 12 5.4 12 12z\"></path></svg>\r\n      <span class=\"plyr__tooltip\">${this.configurator.i18n.nextEpisode}</span>\r\n      </button>`,\r\n      true\r\n    );\r\n    // Nút previous tập\r\n    // Previous episode btn\r\n    // <i class=\"fas fa-step-backward fa-lg\"></i>\r\n    this.insertBefore(\r\n      khpCtn.querySelector(\".plyr__controls > button:nth-child(1)\"),\r\n      `<button class=\"plyr__controls__item plyr__control customBtn prevEpBtn\" type=\"button\" onclick=\"KHPlayer.navigateEp(this,'prev')\">\r\n      <svg aria-hidden=\"true\" focusable=\"false\" data-prefix=\"fas\" data-icon=\"step-backward\" class=\"svg-inline--fa fa-step-backward fa-w-14\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 448 512\"><path fill=\"currentColor\" d=\"M64 468V44c0-6.6 5.4-12 12-12h48c6.6 0 12 5.4 12 12v176.4l195.5-181C352.1 22.3 384 36.6 384 64v384c0 27.4-31.9 41.7-52.5 24.6L136 292.7V468c0 6.6-5.4 12-12 12H76c-6.6 0-12-5.4-12-12z\"></path></svg>\r\n      <span class=\"plyr__tooltip\">${this.configurator.i18n.previousEpisode}</span>\r\n      </button>`,\r\n      true\r\n    );\r\n    //#endregion\r\n\r\n    // #region Embed playlist\r\n    /* Source:\r\n      https://stackoverflow.com/a/18602389\r\n      https://www.w3schools.com/jsref/met_node_clonenode.asp\r\n    Cấu trúc Playlist mới trong Player để overlay nút đóng playlist lên trên playlist:\r\n    // DOM structure in order to overlay close btn over embed playlist\r\n\r\n    <div class=\"embed-playlist\"> -> position: absolute -> chiếm trọn ô chứa Plyr | took over Plyr's container\r\n      <div> -> position: relative -> để cái nút đóng playlist hiện trên cùng | For overlaying close btn over embed playlist \r\n        <ul></ul> -> position: relative\r\n        <div>Nút đóng playlist | Hide embed playlist btn</div> -> position: absolute -> góc trên bên phải | sitting at top right corner of the embed playlist\r\n      </div>\r\n    </div>\r\n\r\n    */\r\n    this.insertBefore(\r\n      khpCtn.querySelector('.plyr>.plyr__control'),\r\n      this.string2Node(`<div class='EmbedKHPPlaylist hidden' key='${uniqueKey}'><div></div></div>`)\r\n    );\r\n    this.s(`.EmbedKHPPlaylist[key='${uniqueKey}']>div`).appendChild(this.s(`.KHPPlaylistContainer[key='${uniqueKey}']`).cloneNode(true));\r\n\r\n    // Nút ẩn/hiện embed playlist ở thanh điều khiển của Plyr\r\n    // Toggle embed playlist btn in Plyr's control bar\r\n    this.s(`.EmbedKHPPlaylist[key='${uniqueKey}']>div`).appendChild(this.string2Node(`<div class=\"closeEmbed\">\r\n    <svg aria-hidden=\"true\" focusable=\"false\" data-prefix=\"fas\" data-icon=\"window-close\" class=\"svg-inline--fa fa-window-close fa-w-16\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 512 512\"><path fill=\"currentColor\" d=\"M464 32H48C21.5 32 0 53.5 0 80v352c0 26.5 21.5 48 48 48h416c26.5 0 48-21.5 48-48V80c0-26.5-21.5-48-48-48zm-83.6 290.5c4.8 4.8 4.8 12.6 0 17.4l-40.5 40.5c-4.8 4.8-12.6 4.8-17.4 0L256 313.3l-66.5 67.1c-4.8 4.8-12.6 4.8-17.4 0l-40.5-40.5c-4.8-4.8-4.8-12.6 0-17.4l67.1-66.5-67.1-66.5c-4.8-4.8-4.8-12.6 0-17.4l40.5-40.5c4.8-4.8 12.6-4.8 17.4 0l66.5 67.1 66.5-67.1c4.8-4.8 12.6-4.8 17.4 0l40.5 40.5c4.8 4.8 4.8 12.6 0 17.4L313.3 256l67.1 66.5z\"></path></svg></div>`));\r\n    this.s(`.EmbedKHPPlaylist[key='${uniqueKey}']>div>.KHPPlaylistContainer`).classList.remove(\"KHPPlaylistContainer\");\r\n\r\n    // Event đóng embed playlist\r\n    // Event close embed playlist\r\n    khpCtn.querySelector(\" .plyr__video-wrapper\").addEventListener(\"click\", () => {\r\n      this.toggleEmbedPlayllist(uniqueKey, true);\r\n    });\r\n    khpCtn.querySelector(\".closeEmbed\").addEventListener(\"click\", () => {\r\n      this.toggleEmbedPlayllist(uniqueKey, true);\r\n    });\r\n    // #endregion\r\n  },\r\n  // Function đổi tập. Thay vì loop epindex như trước, gây một vài vấn đề về tương thích, mình tách luôn ra thành function riêng.\r\n\r\n  async changeEp(elem, epIndex) {\r\n    let\r\n      // Lấy uniqueKey từ <ul> đã nhồi nhét sẵn\r\n      uniqueKey = await elem.parentNode.getAttribute(\"key\"),\r\n      // Viết tắt của uniqueKeySelector\r\n      khpCtn = this.id(uniqueKey);\r\n\r\n    // -- Highlight <li> đang phát --\r\n    // -- Highlight playing <li> --\r\n    for (let ep of khpCtn.querySelector(\".KHPPlaylistContainer\").querySelectorAll(\"li\")) ep.removeAttribute(\"playing\");\r\n    khpCtn.querySelectorAll(\".KHPPlaylistContainer li\")[epIndex].setAttribute(\"playing\", \"\");\r\n    // #endregion\r\n\r\n    // -- Dữ liệu episode cần init --\r\n    // -- Episode's data need to init --\r\n    let currData = this.data[uniqueKey][epIndex];\r\n\r\n    // Chuyển từ tập này sang tập khác qua API .source của Plyr thì được, nhưng nhảy qua nhảy lại giữa source HLS với Plyr thì không. Cách giải quyết đơn giản nhất là destroy() luôn cái Plyr player đang phát rồi init lại cái mới.\r\n    // It's perfectly fine when switching between episodes using Plyr's .source API, but not when HLS get involved. So the quickest/easiest way is to destroy() current Plyr and init a new one.\r\n    this.plyr[uniqueKey][0].destroy();\r\n    this.plyr[uniqueKey] = await this.initPlyr(uniqueKey, currData.previewThumbnails);\r\n    this.tweaks(uniqueKey);\r\n\r\n    // Check dữ liệu xem dùng Plyr hay HLS để load dữ liệu.\r\n    // Check media type to determine using Plyr's API or HLS's one.\r\n    let currVideoTag = khpCtn.querySelector(\"video\"),\r\n      currMedia = currData.sources[0];\r\n    if (currMedia.type.toUpperCase() === \"M3U8\") {\r\n      this.m3u8(currVideoTag, currMedia.src);\r\n      // Không như Plyr, HLS chỉ có tác dụng load file m3u8, phụ đề phải thêm thủ công.\r\n      // Unlike Plyr, HLS only load m3u8 file, captions must be manually adding.\r\n      if (currData.tracks)\r\n        for (let track of currData.tracks) this.addSubsForLibsPlayer(currVideoTag, track);\r\n    } else {\r\n      this.plyr[uniqueKey][0].source = currData;\r\n      this.plyr[uniqueKey][0].play();\r\n    }\r\n\r\n    // -- Giới hạn chiều cao của các danh sách chọn phụ đề, độ phân giải, tốc độ --\r\n    // #region -- Limit Plyr's menu height inside Plyr's div --\r\n    let limitPlyrListHeight = type => {\r\n      let\r\n        selectPlyr = khpCtn.querySelector('.plyr'),\r\n        typeSelect = selectPlyr.querySelector(`button[data-plyr=\"${type}\"]`);\r\n      if (typeSelect) {\r\n        let typeSelectCtn = typeSelect.parentNode;\r\n        let setMaxHeight = () => typeSelectCtn.style.maxHeight = `calc(${parseInt(window.getComputedStyle(selectPlyr).height,10)}px - 105px)`;\r\n        setMaxHeight();\r\n        window.addEventListener(\"resize\", () => setMaxHeight());\r\n        typeSelectCtn.style.overflow = \"auto\";\r\n        typeSelectCtn.classList.add(\"custom_scrollbar\");\r\n      }\r\n    };\r\n    let loopCheckMediaLoaded = setInterval(() => {\r\n      if (khpCtn.querySelector(\".plyr video\").readyState === 4) {\r\n        for (let item of [\"language\", \"speed\", \"quality\"]) limitPlyrListHeight(item);\r\n        clearInterval(loopCheckMediaLoaded);\r\n      }\r\n    }, 500);\r\n    //#endregion\r\n\r\n    // -- Tự động next khi hết tập --\r\n    // #region -- Autoplay next episode -- \r\n    this.plyr[uniqueKey][0].on('ended', function () {\r\n      // nextElementSubling/nextSibling: https://stackoverflow.com/a/24226603\r\n      let current_episode = KHPlayer.selectCurrEp(uniqueKey),\r\n        next_episode = current_episode.nextElementSibling;\r\n      // Source: https://www.w3schools.com/jsref/met_html_click.asp\r\n      if (next_episode) next_episode.click();\r\n    });\r\n    // #endregion\r\n\r\n    // #region -- Lưu thời gian video đang xem mỗi 1 giây vào localStorage --\r\n    // Tạo interval rỗng -> clear đi -> tạo lại cái mới, tránh dẫn đến việc nhiều cái setInterval khác nhau mỗi khi đổi tập.\r\n    // Create empty interval -> clear -> create new one to avoid duplicate interval when switching episodes.\r\n    let historyPlayingIndicator = this.data[uniqueKey][this.data[uniqueKey].length - 1];\r\n    let saveCurrTimeEp = setInterval(function () {}, 1000);\r\n    clearInterval(saveCurrTimeEp);\r\n    saveCurrTimeEp = setInterval(() => {\r\n      if (khpCtn.querySelector(\".plyr video\").readyState === 4)\r\n        localStorage.setItem(\"khplayer_playing_\" + historyPlayingIndicator, JSON.stringify({\r\n          epIndex: epIndex,\r\n          time: Math.round(KHPlayer.plyr[uniqueKey][0].currentTime)\r\n        }));\r\n    }, 1000);\r\n    //#endregion\r\n\r\n    let adjustSpeed = () => {\r\n      // console.log(this.plyr[uniqueKey][0].speed);\r\n      if (event.shiftKey && event.keyCode == \"190\") this.plyr[uniqueKey][0].speed += 0.5;\r\n      if (event.shiftKey && event.keyCode == \"188\") this.plyr[uniqueKey][0].speed -= 0.5;\r\n    };\r\n    khpCtn.removeEventListener('keydown', adjustSpeed);\r\n    khpCtn.addEventListener('keydown', adjustSpeed);\r\n\r\n  },\r\n  toggleEmbedPlayllist(uniqueKey, hideOnly = false) {\r\n    let elem = this.s(`.EmbedKHPPlaylist[key='${uniqueKey}']`);\r\n    if (hideOnly) {\r\n      elem.classList.add(\"hidden\");\r\n    } else {\r\n      if (elem.classList.contains(\"hidden\")) {\r\n        elem.classList.remove(\"hidden\");\r\n      } else {\r\n        elem.classList.add(\"hidden\");\r\n      }\r\n    }\r\n  },\r\n  insertAfter(elem, data, string2Elem = false) {\r\n    // Source: https://github.com/nefe/You-Dont-Need-jQuery#3.7\r\n    if (!string2Elem) elem.parentNode.insertBefore(data, elem.nextSibling);\r\n    if (string2Elem) elem.parentNode.insertBefore(this.string2Node(data), elem.nextSibling);\r\n  },\r\n  insertBefore(elem, data, string2Elem = false) {\r\n    if (string2Elem) elem.parentNode.insertBefore(this.string2Node(data), elem);\r\n    if (!string2Elem) elem.parentNode.insertBefore(data, elem);\r\n  },\r\n  selectCurrEp(uniqueKey) {\r\n    return this.s(`#${uniqueKey} .KHPPlaylistContainer li[playing]`);\r\n  },\r\n  navigateEp(elem, nextOrPrev) {\r\n    let uniqueKey = elem.parentNode.parentNode.parentNode.getAttribute(\"id\"),\r\n      currEp = this.selectCurrEp(uniqueKey);\r\n    if (!currEp) this.d.querySelectorAll(\"#\" + uniqueKey + \" .KHPPlaylistContainer li\")[0].click();\r\n    if (currEp) {\r\n      let\r\n        nextEp = currEp.nextElementSibling,\r\n        prevEp = currEp.previousElementSibling;\r\n      if (nextOrPrev === \"next\") {\r\n        if (nextEp) nextEp.click();\r\n      }\r\n      if (nextOrPrev === \"prev\") {\r\n        if (!prevEp) currEp.click();\r\n        if (prevEp) prevEp.click();\r\n      }\r\n    }\r\n  },\r\n  acceptContinue(uniqueKey, epIndex, time) {\r\n    let khpCtn = this.id(uniqueKey);\r\n    khpCtn.querySelectorAll(`.KHPPlaylistContainer li`)[epIndex].click();\r\n    var tempLoop = setInterval(() => {\r\n      if (khpCtn.querySelector(`.plyr video`).readyState === 4) {\r\n        KHPlayer.plyr[uniqueKey][0].currentTime = time;\r\n        clearInterval(tempLoop);\r\n      }\r\n    }, 100);\r\n  },\r\n  rejectContinue(elem) {\r\n    elem.parentNode.parentNode.parentNode.classList.add(\"hideAlert\");\r\n    elem.parentNode.parentNode.parentNode.parentNode.querySelector('.plyr__controls').removeAttribute('hidden');\r\n  },\r\n  m3u8(elem, source) {\r\n    if (Hls.isSupported()) {\r\n      let hls = new Hls();\r\n      hls.loadSource(source);\r\n      hls.attachMedia(elem);\r\n      hls.on(Hls.Events.MANIFEST_PARSED, () => elem.play());\r\n    } else {\r\n      console.log(new Error('HLS.js is required for playback M3U8 media'));\r\n    }\r\n  },\r\n  // Source: http://youmightnotneedjquery.com/\r\n  getJSON(url) {\r\n    return new Promise(resolve => {\r\n      var request = new XMLHttpRequest();\r\n      request.open('GET', url, true);\r\n      request.onreadystatechange = function () {\r\n        if (this.readyState === 4) {\r\n          if (this.status >= 200 && this.status < 400) {\r\n            resolve(JSON.parse(this.responseText));\r\n          } else {\r\n            resolve(void 0);\r\n          }\r\n        }\r\n      };\r\n      request.send();\r\n      request = null;\r\n    });\r\n  },\r\n  addSubsForLibsPlayer(elem, data) {\r\n    elem.appendChild(this.string2Node(`<track kind=\"subtitles\" label=\"${data.label}\" srclang=\"${data.srclang}\" src=\"${data.src}\">`));\r\n  },\r\n  // Source: https://stackoverflow.com/a/35385518\r\n  string2Node(html) {\r\n    var template = this.d.createElement('template');\r\n    html = html.trim(); // Never return a text node of whitespace as the result\r\n    template.innerHTML = html;\r\n    return template.content.firstChild;\r\n  },\r\n  // Source: https://developer.mozilla.org/en-US/docs/Web/API/Document/currentScript\r\n  customConfigPath: document.currentScript.getAttribute(\"config\"),\r\n  // All videos' jsons' data\r\n  data: {},\r\n  // for Plyr to interact\r\n  plyr: {}\r\n};\r\ndocument.addEventListener(\"DOMContentLoaded\", async () => {\r\n  let defaultConfig = {\r\n    defaultQuality: 1080,\r\n    seekTime: 5,\r\n    invertTime: false,\r\n    captions: {\r\n      active: true,\r\n      language: 'auto',\r\n      update: true\r\n    },\r\n    tooltips: {\r\n      controls: true,\r\n      seek: true\r\n    },\r\n    defaultPoster: \"https://cdn.jsdelivr.net/gh/DELNEGEND/khplayer/dist/default_wating.svg\",\r\n    blankVideo: \"https://cdn.jsdelivr.net/gh/DELNEGEND/khplayer/dist/blank.mp4\",\r\n    i18n: {\r\n      restart: 'Khởi động lại',\r\n      rewind: 'Tua trước {seektime}s',\r\n      play: 'Phát',\r\n      pause: 'Tạm dừng',\r\n      fastForward: 'Tua tới {seektime}s',\r\n      seek: 'Tua',\r\n      seekLabel: '{currentTime} của {duration}',\r\n      played: 'Đã phát',\r\n      buffered: 'Đã tải trước',\r\n      currentTime: 'Thời gian bây giờ',\r\n      duration: 'Thời lượng',\r\n      volume: 'Âm lượng',\r\n      mute: 'Tắt tiếng',\r\n      unmute: 'Bật tiếng',\r\n      enableCaptions: 'Bật phụ đề',\r\n      disableCaptions: 'Tắt phụ đề',\r\n      download: 'Tải xuống',\r\n      enterFullscreen: 'Toàn màn hình',\r\n      exitFullscreen: 'Thoát toàn màn hình',\r\n      frameTitle: 'Trình phát cho {title}',\r\n      captions: 'Phụ đề',\r\n      settings: 'Cài đặt',\r\n      pip: 'PIP',\r\n      menuBack: 'Quay lại',\r\n      speed: 'Tốc độ',\r\n      normal: 'Bình thường',\r\n      quality: 'Chất lượng',\r\n      loop: 'Lặp',\r\n      start: 'Bắt đầu',\r\n      end: 'Kết thúc',\r\n      all: 'Tất cả',\r\n      reset: 'Khởi động lại',\r\n      disabled: 'Tắt',\r\n      enabled: 'Bật',\r\n      advertisement: 'Quảng cáo',\r\n      qualityBadge: {\r\n        2160: '4K',\r\n        1440: 'HD',\r\n        1080: 'HD',\r\n        720: 'HD',\r\n        576: 'SD',\r\n        480: 'SD',\r\n      },\r\n      nextEpisode: 'Tập tiếp theo',\r\n      previousEpisode: 'Tập trước',\r\n      toggleEmbedPlayllist: 'Danh sách tập',\r\n      continueWatchingConfirm: {\r\n        yes: 'Có',\r\n        no: 'Không',\r\n        continueWatching: 'Tiếp tục',\r\n        at: 'tại',\r\n        confirm: ''\r\n      }\r\n    },\r\n  };\r\n  let configURL = KHPlayer.customConfigPath,\r\n    customConfigData;\r\n  if (configURL) customConfigData = await KHPlayer.getJSON(configURL) || {};\r\n  let configData = {\r\n    ...defaultConfig,\r\n    ...customConfigData\r\n  };\r\n  KHPlayer.configurator = configData;\r\n  for await (let elem of document.querySelectorAll('khplayer-container')) {\r\n    // Assign uniqueKey to avoid conflic between multiple khplayer-container when changeEp() or cloning playlist into embed playlist\r\n    // Gán uniqueKey để tránh xung đột với các khplayer-container khác khi chuyển tập hay clone playlist lên embed playlist\r\n    let uniqueKey = KHPlayer.randomString();\r\n    elem.setAttribute(\"id\", uniqueKey);\r\n    KHPlayer.init(uniqueKey);\r\n  }\r\n});"],"file":"khplayer.min.js"}