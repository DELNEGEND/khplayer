const KHPlayer={d:e=>document.querySelector(e),id:e=>document.getElementById(e),randomString(e=20){let t="";const i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=i.length;for(let r=0;r<e;r++)t+=i.charAt(Math.floor(Math.random()*n));return"_"+t+btoa((new Date).getTime()).replace(/=/g,"")},one(){this.insertAfter(this.currNode,`<khplayer-container data="${this.currNode.getAttribute("data")}"></khplayer-container>`,!0),this.loadCSS("https://cdn.jsdelivr.net/gh/sampotts/plyr/dist/plyr.css"),this.loadCSS("https://cdn.jsdelivr.net/gh/DELNEGEND/khplayer/dist/khplayer.min.css"),"undefined"==typeof Plyr&&this.loadJS("https://cdn.jsdelivr.net/gh/sampotts/plyr/dist/plyr.min.js"),"undefined"==typeof Hls&&this.loadJS("https://cdn.jsdelivr.net/npm/hls.js/dist/hls.min.js"),"undefined"==typeof NoSleep&&this.loadJS("https://cdn.jsdelivr.net/gh/richtr/NoSleep.js/dist/NoSleep.min.js");const e=setInterval(()=>{if("undefined"!==(typeof Plyr&&typeof Hls&&typeof NoSleep)){clearInterval(e);const t=KHPlayer.randomString();this.currNode.nextElementSibling.setAttribute("id",t),this.init(t)}},100)},initPlyr(e,t=!1){const i=Object.assign({},this.configurator);return t&&(i.previewThumbnails={enabled:!0,src:t.src}),new Promise(function(t){t(Plyr.setup("#"+e+" video",i))})},async init(e){const t=this.id(e);this.data[e]=await this.getJSON(t.getAttribute("data")),PLAYLIST=this.data[e];const i=PLAYLIST[PLAYLIST.length-2]||this.configurator.defaultPoster,n=PLAYLIST[PLAYLIST.length-1];t.innerHTML=`\n<video control playsinline></video>\n<ul key="${e}" class='KHPPlaylistContainer custom_scrollbar'></ul>`,t.querySelector("video").setAttribute("poster",i);for(let e=0;e<PLAYLIST.length-2;e++){const i=document.createElement("li");i.setAttribute("onclick",`KHPlayer.changeEp(this,${e})`),i.innerHTML=PLAYLIST[e].title,t.querySelector(".KHPPlaylistContainer").appendChild(i)}this.plyr[e]=await this.initPlyr(e),this.id(e)&&this.tweaks(e);const r=localStorage.getItem("khplayer_playing_"+n);if(r){const i=JSON.parse(r),n=this.configurator.i18n.continueWatchingConfirm;this.insertAfter(t.querySelector(" .plyr>.plyr__control"),`<div class="systemDetectHistory">\n<div class="text">\n${n.continueWatching} <b>${KHPlayer.data[e][i.epIndex].title}</b> ${n.at} <b>${new Date(1e3*i.time).toISOString().substr(11,8)}</b>${n.confirm}\n</div>\n<div class="actions">\n<div class="confirmBtn">\n<div onclick='KHPlayer.acceptContinue("${e}", ${i.epIndex}, ${i.time})' class="buttonInner">${n.yes}</div>\n</div>\n<div class="confirmBtn">\n<div onclick='KHPlayer.rejectContinue(this)' class="buttonInner">${n.no}</div>\n</div>\n</div>\n</div>`,!0),t.querySelector(".plyr>.plyr__controls")&&t.querySelector(".plyr>.plyr__controls").setAttribute("hidden","")}t.querySelector(".plyr").addEventListener("click",()=>{if(r){const i=t.querySelector(".systemDetectHistory");i&&i.classList.contains("hideAlert")&&!this.plyr[e][0].source&&t.querySelector("ul.KHPPlaylistContainer>li:first-child").click()}else this.plyr[e][0].source||t.querySelector("ul.KHPPlaylistContainer>li:first-child").click()})},tweaks(e){const t=this.id(e);this.insertAfter(t.querySelector(".plyr__controls>.plyr__menu"),`<button class="plyr__controls__item plyr__control customBtn" type="button" onclick="KHPlayer.toggleEmbedPlayllist('${e}')">\n<svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="list-ul" class="svg-inline--fa fa-list-ul fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M48 48a48 48 0 1 0 48 48 48 48 0 0 0-48-48zm0 160a48 48 0 1 0 48 48 48 48 0 0 0-48-48zm0 160a48 48 0 1 0 48 48 48 48 0 0 0-48-48zm448 16H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-320H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16zm0 160H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16z"></path></svg>\n<span class="plyr__tooltip">${this.configurator.i18n.toggleEmbedPlayllist}</span>\n</button>`,!0),this.insertAfter(t.querySelector(".plyr__controls > button:first-child"),`<button class="plyr__controls__item plyr__control customBtn nextEpBtn" type="button" onclick="KHPlayer.navigateEp(this,'next')">\n<svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="step-forward" class="svg-inline--fa fa-step-forward fa-w-14" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M384 44v424c0 6.6-5.4 12-12 12h-48c-6.6 0-12-5.4-12-12V291.6l-195.5 181C95.9 489.7 64 475.4 64 448V64c0-27.4 31.9-41.7 52.5-24.6L312 219.3V44c0-6.6 5.4-12 12-12h48c6.6 0 12 5.4 12 12z"></path></svg>\n<span class="plyr__tooltip">${this.configurator.i18n.nextEpisode}</span>\n</button>`,!0),this.insertBefore(t.querySelector(".plyr__controls > button:first-child"),`<button class="plyr__controls__item plyr__control customBtn prevEpBtn" type="button" onclick="KHPlayer.navigateEp(this,'prev')">\n<svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="step-backward" class="svg-inline--fa fa-step-backward fa-w-14" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M64 468V44c0-6.6 5.4-12 12-12h48c6.6 0 12 5.4 12 12v176.4l195.5-181C352.1 22.3 384 36.6 384 64v384c0 27.4-31.9 41.7-52.5 24.6L136 292.7V468c0 6.6-5.4 12-12 12H76c-6.6 0-12-5.4-12-12z"></path></svg>\n<span class="plyr__tooltip">${this.configurator.i18n.previousEpisode}</span>\n</button>`,!0),this.insertBefore(t.querySelector(".plyr>.plyr__control"),this.string2Node(`<div class='EmbedKHPPlaylist hidden' key='${e}'><div></div></div>`)),this.d(`.EmbedKHPPlaylist[key='${e}']>div`).appendChild(this.d(`.KHPPlaylistContainer[key='${e}']`).cloneNode(!0)),this.d(`.EmbedKHPPlaylist[key='${e}']>div`).appendChild(this.string2Node('\n<div class="closeEmbed">\n<svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="times-circle" class="svg-inline--fa fa-times-circle fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm121.6 313.1c4.7 4.7 4.7 12.3 0 17L338 377.6c-4.7 4.7-12.3 4.7-17 0L256 312l-65.1 65.6c-4.7 4.7-12.3 4.7-17 0L134.4 338c-4.7-4.7-4.7-12.3 0-17l65.6-65-65.6-65.1c-4.7-4.7-4.7-12.3 0-17l39.6-39.6c4.7-4.7 12.3-4.7 17 0l65 65.7 65.1-65.6c4.7-4.7 12.3-4.7 17 0l39.6 39.6c4.7 4.7 4.7 12.3 0 17L312 256l65.6 65.1z"></path></svg>\n</div>')),this.d(`.EmbedKHPPlaylist[key='${e}']>div>.KHPPlaylistContainer`).classList.remove("KHPPlaylistContainer"),t.querySelector(" .plyr__video-wrapper").addEventListener("click",()=>{this.toggleEmbedPlayllist(e,!0)}),t.querySelector(".closeEmbed").addEventListener("click",()=>{this.toggleEmbedPlayllist(e,!0)})},async changeEp(e,t){const i=await e.parentNode.getAttribute("key"),n=this.id(i);for(const e of n.querySelector(".KHPPlaylistContainer").querySelectorAll("li"))e.removeAttribute("playing");n.querySelectorAll(".KHPPlaylistContainer li")[t].setAttribute("playing","");const r=this.data[i][t];this.plyr[i][0].destroy(),this.plyr[i]=await this.initPlyr(i,r.previewThumbnails),this.tweaks(i);const l=n.querySelector("video"),s=r.sources[0];if("M3U8"===s.type.toUpperCase()){if(this.m3u8(l,s.src),r.tracks)for(const e of r.tracks)this.addSubsForLibsPlayer(l,e)}else this.plyr[i][0].source=r,this.plyr[i][0].play();const a=e=>{const t=n.querySelector(".plyr"),i=t.querySelector(`button[data-plyr="${e}"]`);if(i){const e=i.parentNode,n=()=>e.style.maxHeight=`calc(${parseInt(window.getComputedStyle(t).height,10)}px - 105px)`;n(),window.addEventListener("resize",()=>n()),e.style.overflow="auto",e.classList.add("custom_scrollbar")}},o=setInterval(()=>{if(4===n.querySelector(".plyr video").readyState){for(const e of["language","speed","quality"])a(e);clearInterval(o)}},500);this.plyr[i][0].on("ended",function(){const e=KHPlayer.selectCurrEp(i).nextElementSibling;e&&e.click()});const c=this.data[i][this.data[i].length-1];let d=setInterval(function(){},1e3);clearInterval(d),d=setInterval(()=>{4===n.querySelector(".plyr video").readyState&&localStorage.setItem("khplayer_playing_"+c,JSON.stringify({epIndex:t,time:Math.round(KHPlayer.plyr[i][0].currentTime)}))},1e3);const p=()=>{event.shiftKey&&"190"==event.keyCode&&(this.plyr[i][0].speed+=.5),event.shiftKey&&"188"==event.keyCode&&(this.plyr[i][0].speed-=.5)};n.removeEventListener("keydown",p),n.addEventListener("keydown",p),(new NoSleep).enable()},toggleEmbedPlayllist(e,t=!1){const i=this.d(`.EmbedKHPPlaylist[key='${e}']`);t?i.classList.add("hidden"):i.classList.contains("hidden")?i.classList.remove("hidden"):i.classList.add("hidden")},insertAfter(e,t,i=!1){e&&(i||e.parentNode.insertBefore(t,e.nextSibling),i&&e.parentNode.insertBefore(this.string2Node(t),e.nextSibling))},insertBefore(e,t,i=!1){i&&e.parentNode.insertBefore(this.string2Node(t),e),i||e.parentNode.insertBefore(t,e)},selectCurrEp(e){return this.d(`#${e} .KHPPlaylistContainer li[playing]`)},navigateEp(e,t){const i=e.parentNode.parentNode.parentNode.getAttribute("id"),n=this.selectCurrEp(i);if(n||document.querySelectorAll("#"+i+" .KHPPlaylistContainer li")[0].click(),n){const e=n.nextElementSibling,i=n.previousElementSibling;"next"===t&&e&&e.click(),"prev"===t&&(i||n.click(),i&&i.click())}},acceptContinue(e,t,i){const n=this.id(e);n.querySelectorAll(".KHPPlaylistContainer li")[t].click();const r=setInterval(()=>{4===n.querySelector(".plyr video").readyState&&(KHPlayer.plyr[e][0].currentTime=i,clearInterval(r))},100)},rejectContinue(e){e.parentNode.parentNode.parentNode.classList.add("hideAlert"),e.parentNode.parentNode.parentNode.parentNode.querySelector(".plyr__controls").removeAttribute("hidden")},m3u8(e,t){if(Hls.isSupported()){const i=new Hls;i.loadSource(t),i.attachMedia(e),i.on(Hls.Events.MANIFEST_PARSED,()=>e.play())}else console.log(new Error("HLS.js is required for playback M3U8 media"))},getJSON:e=>new Promise(t=>{let i=new XMLHttpRequest;i.open("GET",e,!0),i.onreadystatechange=function(){4===this.readyState&&(this.status>=200&&this.status<400?t(JSON.parse(this.responseText)):t(void 0))},i.send(),i=null}),addSubsForLibsPlayer(e,t){e.appendChild(this.string2Node(`<track kind="subtitles" label="${t.label}" srclang="${t.srclang}" src="${t.src}">`))},string2Node(e){const t=document.createElement("template");return e=e.trim(),t.innerHTML=e,t.content.firstChild},loadCSS(e){const t=document.createElement("link");t.rel="stylesheet",t.type="text/css",t.href=e,document.head.appendChild(t)},loadJS(e,t){const i=document.createElement("script");i.type="text/javascript",i.src=e,i.onreadystatechange=t,i.onload=t,document.head.appendChild(i)},currNode:document.currentScript,customConfigPath:document.currentScript.getAttribute("config"),configurator:{defaultQuality:1080,seekTime:5,invertTime:!1,captions:{active:!0,language:"auto",update:!0},tooltips:{controls:!0,seek:!0},defaultPoster:"https://cdn.jsdelivr.net/gh/DELNEGEND/khplayer/dist/default_wating.svg",blankVideo:"https://cdn.jsdelivr.net/gh/DELNEGEND/khplayer/dist/blank.mp4"},data:{},plyr:{}};document.addEventListener("DOMContentLoaded",async()=>{const e=KHPlayer.customConfigPath;let t={},i={};const n={i18n:{restart:"Khởi động lại",rewind:"Tua trước {seektime}s",play:"Phát",pause:"Tạm dừng",fastForward:"Tua tới {seektime}s",seek:"Tua",seekLabel:"{currentTime} của {duration}",played:"Đã phát",buffered:"Đã tải trước",currentTime:"Thời gian bây giờ",duration:"Thời lượng",volume:"Âm lượng",mute:"Tắt tiếng",unmute:"Bật tiếng",enableCaptions:"Bật phụ đề",disableCaptions:"Tắt phụ đề",download:"Tải xuống",enterFullscreen:"Toàn màn hình",exitFullscreen:"Thoát toàn màn hình",frameTitle:"Trình phát cho {title}",captions:"Phụ đề",settings:"Cài đặt",pip:"PIP",menuBack:"Quay lại",speed:"Tốc độ",normal:"Bình thường",quality:"Chất lượng",loop:"Lặp",start:"Bắt đầu",end:"Kết thúc",all:"Tất cả",reset:"Khởi động lại",disabled:"Tắt",enabled:"Bật",advertisement:"Quảng cáo",qualityBadge:{2160:"4K",1440:"HD",1080:"HD",720:"HD",576:"SD",480:"SD"},nextEpisode:"Tập tiếp theo",previousEpisode:"Tập trước",toggleEmbedPlayllist:"Danh sách tập",continueWatchingConfirm:{yes:"Tiếp tục",no:"Xem từ đầu",continueWatching:"Đang xem",at:"tại",confirm:""}}},r={i18n:{nextEpisode:"Next episode",previousEpisode:"Previous episode",toggleEmbedPlayllist:"Episode list",continueWatchingConfirm:{yes:"Continue",no:"Watch from begin",continueWatching:"You were watching",at:"at",confirm:""}}};if(e&&(t=await KHPlayer.getJSON(e)||{}),i=null!==KHPlayer.currNode.getAttribute("vi")?n:r,KHPlayer.configurator={...KHPlayer.configurator,...i,...t},KHPlayer.currNode.getAttribute("data"))KHPlayer.one();else for await(const e of document.querySelectorAll("khplayer-container")){const t=KHPlayer.randomString();e.setAttribute("id",t),KHPlayer.init(t)}});
//# sourceMappingURL=khplayer.min.js.map
