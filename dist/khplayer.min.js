//! ================================================
//! KHPLayer
//! Version: 6.3
//! Homepage/repo: https://khplayer.delnegend.xyz --redirect--> https://github.com/DELNEGEND/khplayer
//! License: The MIT License (MIT)
//! ================================================
var KHPlayer={d:document,s(e){return this.d.querySelector(e)},id(e){return this.d.getElementById(e)},randomString(e=20){let t="",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",l=i.length;for(let r=0;r<e;r++)t+=i.charAt(Math.floor(Math.random()*l));return"_"+t+btoa((new Date).getTime()).replace(/=/g,"")},one(){this.insertAfter(this.currNode,`<khplayer-container data="${this.currNode.getAttribute("data")}"></khplayer-container>`,!0),this.loadCSS("https://cdn.jsdelivr.net/gh/sampotts/plyr/dist/plyr.css"),this.loadCSS("https://cdn.jsdelivr.net/gh/DELNEGEND/khplayer/dist/khplayer.min.css"),"undefined"==typeof Plyr&&this.loadJS("https://cdn.jsdelivr.net/gh/sampotts/plyr/dist/plyr.min.js"),"undefined"==typeof Hls&&this.loadJS("https://cdn.jsdelivr.net/npm/hls.js/dist/hls.min.js"),"undefined"==typeof NoSleep&&this.loadJS("https://cdn.jsdelivr.net/gh/richtr/NoSleep.js/dist/NoSleep.min.js");let e=setInterval(()=>{if("undefined"!==(typeof Plyr&&typeof Hls&&typeof NoSleep)){clearInterval(e);let t=KHPlayer.randomString();this.currNode.nextElementSibling.setAttribute("id",t),this.init(t)}},100)},initPlyr(e,t=!1){let i=Object.assign({},this.configurator);return t&&(i.previewThumbnails={enabled:!0,src:t.src}),new Promise(function(t){t(Plyr.setup("#"+e+" video",i))})},async init(e){let t=this.id(e);this.data[e]=await this.getJSON(t.getAttribute("data")),PLAYLIST=this.data[e];let i=PLAYLIST[PLAYLIST.length-2]||this.configurator.defaultPoster,l=PLAYLIST[PLAYLIST.length-1];t.innerHTML=`\n<video control playsinline></video>\n<ul key="${e}" class='KHPPlaylistContainer custom_scrollbar'></ul>`,t.querySelector("video").setAttribute("poster",i);for(let e=0;e<PLAYLIST.length-2;e++){let i=this.d.createElement("li");i.setAttribute("onclick",`KHPlayer.changeEp(this,${e})`),i.innerHTML=PLAYLIST[e].title,t.querySelector(".KHPPlaylistContainer").appendChild(i)}this.plyr[e]=await this.initPlyr(e),this.id(e)&&this.tweaks(e);let r=localStorage.getItem("khplayer_playing_"+l);if(r){let i=JSON.parse(r),l=this.configurator.i18n.continueWatchingConfirm;this.insertAfter(t.querySelector(".plyr>.plyr__control"),`<div class="systemDetectHistory">\n<div class="text">${l.continueWatching} ${KHPlayer.data[e][i.epIndex].title} ${l.at} ${new Date(1e3*i.time).toISOString().substr(11,8)}${l.confirm}</div>\n<div class="actions">\n<div class="confirmBtn">\n<div onclick='KHPlayer.acceptContinue("${e}", ${i.epIndex}, ${i.time})' class="buttonInner">${l.yes}</div>\n</div>\n<div class="confirmBtn">\n<div onclick='KHPlayer.rejectContinue(this)' class="buttonInner">${l.no}</div>\n</div>\n</div>\n</div>`,!0),t.querySelector(".plyr>.plyr__controls")&&t.querySelector(".plyr>.plyr__controls").setAttribute("hidden","")}},tweaks(e){let t=this.id(e);this.insertAfter(t.querySelector(".plyr__controls>.plyr__menu"),`<button class="plyr__controls__item plyr__control customBtn" type="button" onclick="KHPlayer.toggleEmbedPlayllist('${e}')">\n<svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="list-ul" class="svg-inline--fa fa-list-ul fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M48 48a48 48 0 1 0 48 48 48 48 0 0 0-48-48zm0 160a48 48 0 1 0 48 48 48 48 0 0 0-48-48zm0 160a48 48 0 1 0 48 48 48 48 0 0 0-48-48zm448 16H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-320H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16zm0 160H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16z"></path></svg>\n<span class="plyr__tooltip">${this.configurator.i18n.toggleEmbedPlayllist}</span>\n</button>`,!0),this.insertAfter(t.querySelector(".plyr__controls > button:nth-child(1)"),`<button class="plyr__controls__item plyr__control customBtn nextEpBtn" type="button" onclick="KHPlayer.navigateEp(this,'next')">\n<svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="step-forward" class="svg-inline--fa fa-step-forward fa-w-14" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M384 44v424c0 6.6-5.4 12-12 12h-48c-6.6 0-12-5.4-12-12V291.6l-195.5 181C95.9 489.7 64 475.4 64 448V64c0-27.4 31.9-41.7 52.5-24.6L312 219.3V44c0-6.6 5.4-12 12-12h48c6.6 0 12 5.4 12 12z"></path></svg>\n<span class="plyr__tooltip">${this.configurator.i18n.nextEpisode}</span>\n</button>`,!0),this.insertBefore(t.querySelector(".plyr__controls > button:nth-child(1)"),`<button class="plyr__controls__item plyr__control customBtn prevEpBtn" type="button" onclick="KHPlayer.navigateEp(this,'prev')">\n<svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="step-backward" class="svg-inline--fa fa-step-backward fa-w-14" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M64 468V44c0-6.6 5.4-12 12-12h48c6.6 0 12 5.4 12 12v176.4l195.5-181C352.1 22.3 384 36.6 384 64v384c0 27.4-31.9 41.7-52.5 24.6L136 292.7V468c0 6.6-5.4 12-12 12H76c-6.6 0-12-5.4-12-12z"></path></svg>\n<span class="plyr__tooltip">${this.configurator.i18n.previousEpisode}</span>\n</button>`,!0),this.insertBefore(t.querySelector(".plyr>.plyr__control"),this.string2Node(`<div class='EmbedKHPPlaylist hidden' key='${e}'><div></div></div>`)),this.s(`.EmbedKHPPlaylist[key='${e}']>div`).appendChild(this.s(`.KHPPlaylistContainer[key='${e}']`).cloneNode(!0)),this.s(`.EmbedKHPPlaylist[key='${e}']>div`).appendChild(this.string2Node('<div class="closeEmbed">\n<svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="window-close" class="svg-inline--fa fa-window-close fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M464 32H48C21.5 32 0 53.5 0 80v352c0 26.5 21.5 48 48 48h416c26.5 0 48-21.5 48-48V80c0-26.5-21.5-48-48-48zm-83.6 290.5c4.8 4.8 4.8 12.6 0 17.4l-40.5 40.5c-4.8 4.8-12.6 4.8-17.4 0L256 313.3l-66.5 67.1c-4.8 4.8-12.6 4.8-17.4 0l-40.5-40.5c-4.8-4.8-4.8-12.6 0-17.4l67.1-66.5-67.1-66.5c-4.8-4.8-4.8-12.6 0-17.4l40.5-40.5c4.8-4.8 12.6-4.8 17.4 0l66.5 67.1 66.5-67.1c4.8-4.8 12.6-4.8 17.4 0l40.5 40.5c4.8 4.8 4.8 12.6 0 17.4L313.3 256l67.1 66.5z"></path></svg></div>')),this.s(`.EmbedKHPPlaylist[key='${e}']>div>.KHPPlaylistContainer`).classList.remove("KHPPlaylistContainer"),t.querySelector(" .plyr__video-wrapper").addEventListener("click",()=>{this.toggleEmbedPlayllist(e,!0)}),t.querySelector(".closeEmbed").addEventListener("click",()=>{this.toggleEmbedPlayllist(e,!0)})},async changeEp(e,t){let i=await e.parentNode.getAttribute("key"),l=this.id(i);for(let e of l.querySelector(".KHPPlaylistContainer").querySelectorAll("li"))e.removeAttribute("playing");l.querySelectorAll(".KHPPlaylistContainer li")[t].setAttribute("playing","");let r=this.data[i][t];this.plyr[i][0].destroy(),this.plyr[i]=await this.initPlyr(i,r.previewThumbnails),this.tweaks(i);let n=l.querySelector("video"),a=r.sources[0];if("M3U8"===a.type.toUpperCase()){if(this.m3u8(n,a.src),r.tracks)for(let e of r.tracks)this.addSubsForLibsPlayer(n,e)}else this.plyr[i][0].source=r,this.plyr[i][0].play();let s=e=>{let t=l.querySelector(".plyr"),i=t.querySelector(`button[data-plyr="${e}"]`);if(i){let e=i.parentNode,l=()=>e.style.maxHeight=`calc(${parseInt(window.getComputedStyle(t).height,10)}px - 105px)`;l(),window.addEventListener("resize",()=>l()),e.style.overflow="auto",e.classList.add("custom_scrollbar")}},o=setInterval(()=>{if(4===l.querySelector(".plyr video").readyState){for(let e of["language","speed","quality"])s(e);clearInterval(o)}},500);this.plyr[i][0].on("ended",function(){let e=KHPlayer.selectCurrEp(i).nextElementSibling;e&&e.click()});let d=this.data[i][this.data[i].length-1],c=setInterval(function(){},1e3);clearInterval(c),c=setInterval(()=>{4===l.querySelector(".plyr video").readyState&&localStorage.setItem("khplayer_playing_"+d,JSON.stringify({epIndex:t,time:Math.round(KHPlayer.plyr[i][0].currentTime)}))},1e3);let p=()=>{event.shiftKey&&"190"==event.keyCode&&(this.plyr[i][0].speed+=.5),event.shiftKey&&"188"==event.keyCode&&(this.plyr[i][0].speed-=.5)};l.removeEventListener("keydown",p),l.addEventListener("keydown",p);let h=new NoSleep;this.plyr[i][0].on("playing",()=>{h.enable()}),this.plyr[i][0].on("paused",()=>{h.disable()})},toggleEmbedPlayllist(e,t=!1){let i=this.s(`.EmbedKHPPlaylist[key='${e}']`);t?i.classList.add("hidden"):i.classList.contains("hidden")?i.classList.remove("hidden"):i.classList.add("hidden")},insertAfter(e,t,i=!1){e&&(i||e.parentNode.insertBefore(t,e.nextSibling),i&&e.parentNode.insertBefore(this.string2Node(t),e.nextSibling))},insertBefore(e,t,i=!1){i&&e.parentNode.insertBefore(this.string2Node(t),e),i||e.parentNode.insertBefore(t,e)},selectCurrEp(e){return this.s(`#${e} .KHPPlaylistContainer li[playing]`)},navigateEp(e,t){let i=e.parentNode.parentNode.parentNode.getAttribute("id"),l=this.selectCurrEp(i);if(l||this.d.querySelectorAll("#"+i+" .KHPPlaylistContainer li")[0].click(),l){let e=l.nextElementSibling,i=l.previousElementSibling;"next"===t&&e&&e.click(),"prev"===t&&(i||l.click(),i&&i.click())}},acceptContinue(e,t,i){let l=this.id(e);l.querySelectorAll(".KHPPlaylistContainer li")[t].click();var r=setInterval(()=>{4===l.querySelector(".plyr video").readyState&&(KHPlayer.plyr[e][0].currentTime=i,clearInterval(r))},100)},rejectContinue(e){e.parentNode.parentNode.parentNode.classList.add("hideAlert"),e.parentNode.parentNode.parentNode.parentNode.querySelector(".plyr__controls").removeAttribute("hidden")},m3u8(e,t){if(Hls.isSupported()){let i=new Hls;i.loadSource(t),i.attachMedia(e),i.on(Hls.Events.MANIFEST_PARSED,()=>e.play())}else console.log(new Error("HLS.js is required for playback M3U8 media"))},getJSON:e=>new Promise(t=>{var i=new XMLHttpRequest;i.open("GET",e,!0),i.onreadystatechange=function(){4===this.readyState&&(this.status>=200&&this.status<400?t(JSON.parse(this.responseText)):t(void 0))},i.send(),i=null}),addSubsForLibsPlayer(e,t){e.appendChild(this.string2Node(`<track kind="subtitles" label="${t.label}" srclang="${t.srclang}" src="${t.src}">`))},string2Node(e){var t=this.d.createElement("template");return e=e.trim(),t.innerHTML=e,t.content.firstChild},loadCSS(e){let t=document.createElement("link");t.rel="stylesheet",t.type="text/css",t.href=e,document.head.appendChild(t)},loadJS(e,t){let i=document.createElement("script");i.type="text/javascript",i.src=e,i.onreadystatechange=t,i.onload=t,document.head.appendChild(i)},currNode:document.currentScript,customConfigPath:document.currentScript.getAttribute("config"),configurator:{defaultQuality:1080,seekTime:5,invertTime:!1,captions:{active:!0,language:"auto",update:!0},tooltips:{controls:!0,seek:!0},defaultPoster:"https://cdn.jsdelivr.net/gh/DELNEGEND/khplayer/dist/default_wating.svg",blankVideo:"https://cdn.jsdelivr.net/gh/DELNEGEND/khplayer/dist/blank.mp4",i18n:{restart:"Khởi động lại",rewind:"Tua trước {seektime}s",play:"Phát",pause:"Tạm dừng",fastForward:"Tua tới {seektime}s",seek:"Tua",seekLabel:"{currentTime} của {duration}",played:"Đã phát",buffered:"Đã tải trước",currentTime:"Thời gian bây giờ",duration:"Thời lượng",volume:"Âm lượng",mute:"Tắt tiếng",unmute:"Bật tiếng",enableCaptions:"Bật phụ đề",disableCaptions:"Tắt phụ đề",download:"Tải xuống",enterFullscreen:"Toàn màn hình",exitFullscreen:"Thoát toàn màn hình",frameTitle:"Trình phát cho {title}",captions:"Phụ đề",settings:"Cài đặt",pip:"PIP",menuBack:"Quay lại",speed:"Tốc độ",normal:"Bình thường",quality:"Chất lượng",loop:"Lặp",start:"Bắt đầu",end:"Kết thúc",all:"Tất cả",reset:"Khởi động lại",disabled:"Tắt",enabled:"Bật",advertisement:"Quảng cáo",qualityBadge:{2160:"4K",1440:"HD",1080:"HD",720:"HD",576:"SD",480:"SD"},nextEpisode:"Tập tiếp theo",previousEpisode:"Tập trước",toggleEmbedPlayllist:"Danh sách tập",continueWatchingConfirm:{yes:"Có",no:"Không",continueWatching:"Tiếp tục",at:"tại",confirm:""}}},data:{},plyr:{}};document.addEventListener("DOMContentLoaded",async()=>{let e,t=KHPlayer.customConfigPath;if(t&&(e=await KHPlayer.getJSON(t)||{}),KHPlayer.configurator={...KHPlayer.configurator,...e},KHPlayer.currNode.getAttribute("data"))KHPlayer.one();else for await(let e of document.querySelectorAll("khplayer-container")){let t=KHPlayer.randomString();e.setAttribute("id",t),KHPlayer.init(t)}});
//# sourceMappingURL=khplayer.min.js.map
