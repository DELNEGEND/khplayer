const KHPlayer={initPlyr(uniqueKey,previewThumbnails=!1){let customConfig=Object.assign({},KHPlayer.configurator);return previewThumbnails&&(customConfig.previewThumbnails={enabled:!0,src:previewThumbnails.src}),new Promise(function(resolve){resolve(Plyr.setup("#"+uniqueKey+" video",customConfig))})},async init(url){let d=document,PLAYLIST_=await KHPlayer.getJSON(url),uniqueKey=await PLAYLIST_[PLAYLIST_.length-1],UKS="#"+uniqueKey;KHPlayer.data[uniqueKey]=PLAYLIST_,PLAYLIST=KHPlayer.data[uniqueKey];let poster=await PLAYLIST[PLAYLIST.length-2];if(d.querySelector(UKS).innerHTML=`\n        <video control playsinline></video>\n        <ul key="${uniqueKey}" class='KHPPlaylistContainer'></ul>`,d.querySelector(UKS+" video").setAttribute("poster",poster),PLAYLIST.length>0){let index=0;for(;index<=PLAYLIST.length-3;){let currentID=+index,currentVid=PLAYLIST[index],list_ep=d.createElement("li");list_ep.setAttribute("index",currentID),d.querySelector(`#${uniqueKey} .KHPPlaylistContainer`).appendChild(list_ep);let currentLine=d.getElementById(uniqueKey).querySelector("li[index='"+currentID+"'");currentLine.innerHTML=currentVid.title,currentLine.setAttribute("onclick","KHPlayer.changeEp(this)"),index++}}let playingData=localStorage.getItem("playing_"+uniqueKey);if(KHPlayer.plyr[uniqueKey]=await KHPlayer.initPlyr(uniqueKey),KHPlayer.tweaks(uniqueKey),null!=playingData){let playingDataJSON=JSON.parse(playingData),confirmi18n=KHPlayer.configurator.i18n.continueWatchingConfirm;KHPlayer._insertBefore(UKS+" .plyr__video-wrapper video",`<div class="systemDetectHistory">\n          <div class="text">${confirmi18n._1} ${KHPlayer.data[uniqueKey][playingDataJSON.epIndex].title} ${confirmi18n._2} ${new Date(1e3*playingDataJSON.time).toISOString().substr(11,8)}<br>${confirmi18n._3}</div>\n          <div class="actions">\n            <div class="confirmBtn">\n              <div onclick='KHPlayer.acceptContinue("${uniqueKey}", ${playingDataJSON.epIndex}, ${playingDataJSON.time})' class="buttonInner">${confirmi18n.yes}</div>\n            </div>\n            <div class="confirmBtn">\n              <div onclick='document.querySelector("#${uniqueKey} .systemDetectHistory").classList.add("hideAlert")' class="buttonInner">${confirmi18n.no}</div>\n            </div>\n          </div>\n        </div>`,!0)}},tweaks(uniqueKey){let d=document,UKS="#"+uniqueKey;KHPlayer.insertAfter(UKS+" .plyr__controls>.plyr__menu",`<button class="plyr__controls__item plyr__control customBtn" type="button" onclick="KHPlayer.togglePlaylist('${uniqueKey}')">\n      <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="list-ul" class="svg-inline--fa fa-list-ul fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M48 48a48 48 0 1 0 48 48 48 48 0 0 0-48-48zm0 160a48 48 0 1 0 48 48 48 48 0 0 0-48-48zm0 160a48 48 0 1 0 48 48 48 48 0 0 0-48-48zm448 16H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-320H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16zm0 160H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16z"></path></svg>\n      <span class="plyr__tooltip">${KHPlayer.configurator.i18n.toggleEmbedPlayllist}</span>\n      </button>`,!0),KHPlayer.insertAfter(UKS+" .plyr__controls > button:nth-child(1)",`<button class="plyr__controls__item plyr__control customBtn nextEpBtn" type="button" onclick="KHPlayer.navigateEp(this,'next')">\n      <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="step-forward" class="svg-inline--fa fa-step-forward fa-w-14" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M384 44v424c0 6.6-5.4 12-12 12h-48c-6.6 0-12-5.4-12-12V291.6l-195.5 181C95.9 489.7 64 475.4 64 448V64c0-27.4 31.9-41.7 52.5-24.6L312 219.3V44c0-6.6 5.4-12 12-12h48c6.6 0 12 5.4 12 12z"></path></svg>\n      <span class="plyr__tooltip">${KHPlayer.configurator.i18n.nextEpisode}</span>\n      </button>`,!0),KHPlayer._insertBefore(UKS+" .plyr__controls > button:nth-child(1)",`<button class="plyr__controls__item plyr__control customBtn prevEpBtn" type="button" onclick="KHPlayer.navigateEp(this,'prev')">\n      <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="step-backward" class="svg-inline--fa fa-step-backward fa-w-14" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M64 468V44c0-6.6 5.4-12 12-12h48c6.6 0 12 5.4 12 12v176.4l195.5-181C352.1 22.3 384 36.6 384 64v384c0 27.4-31.9 41.7-52.5 24.6L136 292.7V468c0 6.6-5.4 12-12 12H76c-6.6 0-12-5.4-12-12z"></path></svg>\n      <span class="plyr__tooltip">${KHPlayer.configurator.i18n.previousEpisode}</span>\n      </button>`,!0),KHPlayer._insertBefore(UKS+" .plyr__video-wrapper video",d.querySelector(`.KHPPlaylistContainer[key='${uniqueKey}']`).cloneNode(!0)),d.querySelector(UKS+" .plyr__video-wrapper .KHPPlaylistContainer").setAttribute("class","EmbedKHPPlaylist hideEmbedKHPPlaylist"),KHPlayer.plyr[uniqueKey][0].on("enterfullscreen",event=>{localStorage.setItem("IsFullScreen_"+uniqueKey,"yes")}),KHPlayer.plyr[uniqueKey][0].on("exitfullscreen",event=>{localStorage.removeItem("IsFullScreen_"+uniqueKey)}),d.querySelector(UKS+" .EmbedKHPPlaylist")||d.querySelector(UKS+" .plyr__video-wrapper").addEventListener("click",()=>{d.querySelector(UKS+" .EmbedKHPPlaylist").classList.add("hideEmbedKHPPlaylist")})},async changeEp(elem){let d=document,index=parseInt(elem.getAttribute("index"),10),uniqueKey=await elem.parentNode.getAttribute("key"),UKS="#"+uniqueKey;select_all=d.querySelector(UKS+" .KHPPlaylistContainer").querySelectorAll("li");let currLi=d.querySelector(`${UKS} .KHPPlaylistContainer li[index='${index}']`);select_all.forEach(function(e){e.removeAttribute("playing"),e.removeAttribute("style")}),currLi.style.color="yellow",currLi.setAttribute("playing","true");let currData=KHPlayer.data[uniqueKey][index];KHPlayer.plyr[uniqueKey][0].destroy(),KHPlayer.plyr[uniqueKey]=await KHPlayer.initPlyr(uniqueKey,currData.previewThumbnails);let currVideoTag=d.querySelector(UKS+" video");if("M3U8"===currData.sources[0].type.toUpperCase()?(KHPlayer.m3u8(currVideoTag,currData.sources[0].src),null!=currData.tracks&&KHPlayer.addSubsForLibsPlayer(UKS+" video",currData.tracks[0])):(KHPlayer.plyr[uniqueKey][0].source=await currData,await KHPlayer.plyr[uniqueKey][0].play()),KHPlayer.plyr[uniqueKey][0].on("ended",function(){let next_episode=KHPlayer.selectCurrEp(uniqueKey).nextElementSibling;null!=next_episode&&next_episode.click()}),"yes"===localStorage.getItem("IsFullScreen_"+uniqueKey)){let loopCheckMediaLoaded=setInterval(()=>{({state:void 0,get newValue(){return this.state},set newValue(newValue){this.state=newValue,4===this.state&&(KHPlayer.togglePlayerFullScreen(uniqueKey),clearInterval(loopCheckMediaLoaded))}}).newValue=d.querySelector(UKS+" .plyr video").readyState},100)}let saveCurrTimeEp=setInterval(function(){},1e3);clearInterval(saveCurrTimeEp),saveCurrTimeEp=setInterval(()=>{({state:void 0,get newValue(){return this.state},set newValue(val){if(this.state=val,4===this.state){let currentPlayingTime=Math.round(KHPlayer.plyr[uniqueKey][0].currentTime);localStorage.setItem("playing_"+uniqueKey,JSON.stringify({epIndex:index,time:currentPlayingTime}))}}}).newValue=d.querySelector(UKS+" .plyr video").readyState},1e3),KHPlayer.tweaks(uniqueKey)},insertAfter(place,data,convertDataToElem=!1){let elem=document.querySelector(place);!1===convertDataToElem?elem.parentNode.insertBefore(data,elem.nextSibling):!0===convertDataToElem&&elem.parentNode.insertBefore(KHPlayer.htmlToElement(data),elem.nextSibling)},_insertBefore(place,data,convertDataToElem=!1){let elem=document.querySelector(place);!1===convertDataToElem?elem.parentNode.insertBefore(data,elem):!0===convertDataToElem&&elem.parentNode.insertBefore(KHPlayer.htmlToElement(data),elem)},togglePlaylist(uniqueKey){document.querySelector("#"+uniqueKey+" .EmbedKHPPlaylist").classList.toggle("hideEmbedKHPPlaylist")},selectCurrEp:uniqueKey=>document.querySelector(`#${uniqueKey} .KHPPlaylistContainer li[playing='true']`),navigateEp(elem,nextOrPrev){let uniqueKey=elem.parentNode.parentNode.parentNode.getAttribute("id"),currEp=KHPlayer.selectCurrEp(uniqueKey);if(null===currEp&&document.querySelector("#"+uniqueKey+" .KHPPlaylistContainer li[index='0']").click(),null!==currEp){let nextEp=currEp.nextElementSibling,prevEp=currEp.previousElementSibling;"next"===nextOrPrev&&null!==nextEp&&nextEp.click(),"prev"===nextOrPrev&&(null===prevEp?currEp.click():prevEp.click())}},togglePlayerFullScreen(uniqueKey){document.querySelector(`#${uniqueKey} button[data-plyr="fullscreen"]`).click()},acceptContinue(uniqueKey,episode,time){document.querySelector(`#${uniqueKey} .KHPPlaylistContainer li[index="${episode}"]`).click();var tempLoop=setInterval(()=>{({status:void 0,get newValue(){return this.status},set newValue(value){this.status=value,4===this.status&&(KHPlayer.plyr[uniqueKey][0].currentTime=time,clearInterval(tempLoop))}}).newValue=document.querySelector(`#${uniqueKey} .plyr video`).readyState},100)},m3u8(elem,source){if(Hls.isSupported()){var hls=new Hls;hls.loadSource(source),hls.attachMedia(elem),hls.on(Hls.Events.MANIFEST_PARSED,function(){elem.play()})}},getJSON:url=>new Promise(function(resolve,reject){var request=new XMLHttpRequest;request.open("GET",url,!0),request.onreadystatechange=function(){if(4===this.readyState)if(this.status>=200&&this.status<400){var data=JSON.parse(this.responseText);resolve(data)}else reject(new Error("Double check JSON path/url"))},request.send(),request=null}),addSubsForLibsPlayer(elem,data){let tempSub=`<track kind="subtitles" label="${data.label}" srclang="${data.srclang}" src="${data.src}">`;document.querySelector(elem).appendChild(KHPlayer.htmlToElement(tempSub))},htmlToElement(html){var template=document.createElement("template");return html=html.trim(),template.innerHTML=html,template.content.firstChild},jsonPaths:JSON.parse(document.currentScript.getAttribute("jsonPath")),data:{},plyr:{}};KHPlayer.jsonPaths.forEach(function(e){KHPlayer.configurator={defaultQuality:1080,seekTime:5,invertTime:!1,captions:{active:!0,language:"auto",update:!0},tooltips:{controls:!0,seek:!0},i18n:{restart:"Khởi động lại",rewind:"Tua trước {seektime}s",play:"Phát",pause:"Tạm dừng",fastForward:"Tua tới {seektime}s",seek:"Tua",seekLabel:"{currentTime} của {duration}",played:"Đã phát",buffered:"Đã tải trước",currentTime:"Thời gian bây giờ",duration:"Thời lượng",volume:"Âm lượng",mute:"Tắt tiếng",unmute:"Bật tiếng",enableCaptions:"Bật phụ đề",disableCaptions:"Tắt phụ đề",download:"Tải xuống",enterFullscreen:"Toàn màn hình",exitFullscreen:"Thoát toàn màn hình",frameTitle:"Trình phát cho {title}",captions:"Phụ đề",settings:"Cài đặt",pip:"PIP",menuBack:"Quay lại",speed:"Tốc độ",normal:"Bình thường",quality:"Chất lượng",loop:"Lặp",start:"Bắt đầu",end:"Kết thúc",all:"Tất cả",reset:"Khởi động lại",disabled:"Tắt",enabled:"Bật",advertisement:"Quảng cáo",qualityBadge:{2160:"4K",1440:"HD",1080:"HD",720:"HD",576:"SD",480:"SD"},nextEpisode:"Tập tiếp theo",previousEpisode:"Tập trước",toggleEmbedPlayllist:"Danh sách tập",continueWatchingConfirm:{yes:"Có",no:"Không",_1:"Hệ thống nhận thấy bạn đã xem đến tập",_2:"tại",_3:"Bạn có muốn tiếp tục không?"}}},KHPlayer.init(e)});
//# sourceMappingURL=khplayer.min.js.map
